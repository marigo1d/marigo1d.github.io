<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"marigo1d.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="AI-Agentè®¾è®¡ç›¸å…³ æ–½å·¥ä¸­â€¦">
<meta property="og:type" content="article">
<meta property="og:title" content="AI-Agent">
<meta property="og:url" content="https://marigo1d.github.io/2025/04/21/AI-Agent/index.html">
<meta property="og:site_name" content="Marigold">
<meta property="og:description" content="AI-Agentè®¾è®¡ç›¸å…³ æ–½å·¥ä¸­â€¦">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/Gu-NqzLb0AAG0lX">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/tool_calling_components-bef9d2bcb9d3706c2fe58b57bf8ccb60.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/structured_output-2c42953cee807dedd6e96f3e1db17f69.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/short-vs-long.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/filter.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/summary.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/5.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/v2-2bcd98f6541da0b6f14dc9082ee2dcda_1440w.jpg">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/image-20250604165407470.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/image-20250604170724823.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/image-20250604173158175.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/image-20250604173209083.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/b2aaf634151b4706892693ffb43d9093.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/prompt_components.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/Medqa-comp.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/black_box_graphic.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/white_box_graphic.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/judges_graphic.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/uqensemble_generate_score.png">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/GsmyMNLasAQ_DY6">
<meta property="og:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/GsmySEdaQAACdBZ">
<meta property="article:published_time" content="2025-04-21T01:19:56.000Z">
<meta property="article:modified_time" content="2025-07-05T08:40:00.624Z">
<meta property="article:author" content="marigo1d">
<meta property="article:tag" content="Python, Pytorch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://marigo1d.github.io/2025/04/21/AI-Agent/Gu-NqzLb0AAG0lX">

<link rel="canonical" href="https://marigo1d.github.io/2025/04/21/AI-Agent/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AI-Agent | Marigold</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Marigold</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Salt, Pepper and Birds~</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://marigo1d.github.io/2025/04/21/AI-Agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="marigo1d">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Marigold">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AI-Agent
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-04-21 09:19:56" itemprop="dateCreated datePublished" datetime="2025-04-21T09:19:56+08:00">2025-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 16:40:00" itemprop="dateModified" datetime="2025-07-05T16:40:00+08:00">2025-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1:20</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>AI-Agentè®¾è®¡ç›¸å…³</p>
<p>æ–½å·¥ä¸­â€¦</p>
<span id="more"></span>
<h1>AI-Agent</h1>
<img src="/2025/04/21/AI-Agent/Gu-NqzLb0AAG0lX" class="" title="Agent_workflow">
<p>AI-Agentä¾§åŒºåˆ†</p>
<ul>
<li>LLMéƒ¨åˆ†ï¼ŒåŒ…å«å¯¹åŸºåº§LLMçš„ç‰¹åŒ–ï¼Œå¦‚SFTå’ŒRLHF</li>
<li>Agentéƒ¨åˆ†ï¼ŒåŒ…å«æ‰§è¡Œé“¾ï¼Œå¦‚ä¸Šä¸‹æ–‡ç®¡ç†ï¼ŒMCPï¼ˆå·¥å…·ç®¡ç†ä¸ä½¿ç”¨ï¼‰</li>
<li>æ•°æ®éƒ¨åˆ†ï¼ŒåŒ…å«è®­ç»ƒæ•°æ®å’Œæ£€ç´¢æ•°æ®ï¼Œå¦‚RAGæ£€ç´¢æ•°æ®ï¼ŒSFTè®­ç»ƒæ•°æ®ï¼ŒFAISSåº“</li>
</ul>
<blockquote>
<p>LLMéƒ¨åˆ†è¯¦è§ LLM&amp;Rela</p>
</blockquote>
<br>
<h2 id="LangChain">LangChain</h2>
<p>LangChain æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºç”±è¯­è¨€æ¨¡å‹é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚å®ƒçš„ç›®æ ‡æ˜¯è®© LLMï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰èƒ½å¤Ÿè®¿é—®å¤–éƒ¨æ•°æ®æºã€æ‰§è¡Œå¤æ‚ä»»åŠ¡é“¾å¼é€»è¾‘ï¼Œå¹¶å…·å¤‡å†³ç­–èƒ½åŠ›ã€‚LangChain æ”¯æŒå¤šç§æ¨¡å—ç»„åˆï¼Œå¦‚æç¤ºæ¨¡æ¿ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€é“¾å¼è°ƒç”¨ã€æ–‡æ¡£é—®ç­”ã€ä»£ç†ç­‰ã€‚</p>
<blockquote>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.langchain.com/">https://docs.langchain.com/</a></p>
</blockquote>
<br>
<h3 id="Model">Model</h3>
<h4 id="Key-methods">Key methods</h4>
<ol>
<li>invokeï¼šä¸èŠå¤©æ¨¡å‹äº¤äº’çš„ä¸»è¦æ–¹æ³•ã€‚å®ƒæ¥å—ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ä½œä¸ºè¾“å‡ºã€‚</li>
<li>streamï¼šå…è®¸æ‚¨ä»¥æµçš„å½¢å¼æ¥æ”¶èŠå¤©æ¨¡å‹ç”Ÿæˆçš„è¾“å‡ºçš„æ–¹æ³•ã€‚</li>
<li>batchï¼šå…è®¸æ‚¨å°†å¤šä¸ªè¯·æ±‚æ‰¹é‡å‘é€åˆ°èŠå¤©æ¨¡å‹ï¼Œä»¥æé«˜å¤„ç†æ•ˆç‡çš„æ–¹æ³•ã€‚</li>
<li>bind_toolsï¼šä¸€ç§å…è®¸æ‚¨å°†å·¥å…·ç»‘å®šåˆ°èŠå¤©æ¨¡å‹ï¼Œä»¥ä¾¿åœ¨æ¨¡å‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚</li>
<li>with_structured_outputï¼šé’ˆå¯¹åŸç”Ÿæ”¯æŒç»“æ„åŒ–è¾“å‡ºçš„æ¨¡å‹çš„ <code>invoke</code> æ–¹æ³•çš„åŒ…è£…å™¨ã€‚</li>
</ol>
<br>
<h4 id="Tool-calling">Tool calling</h4>
<img src="/2025/04/21/AI-Agent/tool_calling_components-bef9d2bcb9d3706c2fe58b57bf8ccb60.png" class="" title="Conceptual parts of tool calling">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tool creation</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply a and b.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tool binding</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply a and b.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        a: first int</span></span><br><span class="line"><span class="string">        b: second int</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line">llm_with_tools = tool_calling_model.bind_tools([multiply])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tool calls</span></span><br><span class="line">query = <span class="string">&quot;What is 3 * 12? Also, what is 11 + 49?&quot;</span></span><br><span class="line"></span><br><span class="line">llm_with_tools.invoke(query).tool_calls</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Structured-Output">Structured Output</h4>
<img src="/2025/04/21/AI-Agent/structured_output-2c42953cee807dedd6e96f3e1db17f69.png" class="" title="Structured output">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define schema</span></span><br><span class="line">schema = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;bar&quot;</span>&#125;</span><br><span class="line"><span class="comment"># Bind schema to model</span></span><br><span class="line">model_with_structure = model.with_structured_output(schema)</span><br><span class="line"><span class="comment"># Invoke the model to produce structured output that matches the schema</span></span><br><span class="line">structured_output = model_with_structure.invoke(user_input)</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Multimodality">Multimodality</h4>
<p>å¤šæ¨¡æ€æŒ‡çš„æ˜¯å¤„ç†ä¸åŒå½¢å¼æ•°æ®çš„èƒ½åŠ›ï¼Œä¾‹å¦‚æ–‡æœ¬ã€éŸ³é¢‘ã€å›¾åƒå’Œè§†é¢‘ã€‚å¤šæ¨¡æ€å¯ä»¥å‡ºç°åœ¨å„ç§ç»„ä»¶ä¸­ï¼Œä½¿æ¨¡å‹å’Œç³»ç»Ÿèƒ½å¤Ÿæ— ç¼åœ°å¤„ç†è¿™äº›æ•°æ®ç±»å‹çš„æ··åˆã€‚</p>
<ul>
<li>èŠå¤©æ¨¡å‹ï¼šç†è®ºä¸Šï¼Œè¿™äº›æ¨¡å‹å¯ä»¥æ¥å—å’Œç”Ÿæˆå¤šæ¨¡æ€è¾“å…¥å’Œè¾“å‡ºï¼Œå¤„ç†å„ç§æ•°æ®ç±»å‹ï¼Œå¦‚æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘ã€‚</li>
<li>åµŒå…¥æ¨¡å‹ï¼šåµŒå…¥æ¨¡å‹å¯ä»¥è¡¨ç¤ºå¤šæ¨¡æ€å†…å®¹ï¼Œå°†å„ç§å½¢å¼çš„æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒå’ŒéŸ³é¢‘ï¼‰åµŒå…¥åˆ°å‘é‡ç©ºé—´ä¸­ã€‚</li>
<li>å‘é‡å­˜å‚¨ï¼šå‘é‡å­˜å‚¨å¯ä»¥æœç´¢è¡¨ç¤ºå¤šæ¨¡æ€æ•°æ®çš„åµŒå…¥ï¼Œå®ç°ä¸åŒç±»å‹ä¿¡æ¯çš„æ£€ç´¢ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"></span><br><span class="line">message = HumanMessage(</span><br><span class="line">    content=[</span><br><span class="line">        &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Describe the weather in this image:&quot;</span>&#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source_type&quot;</span>: <span class="string">&quot;base64&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: <span class="string">&quot;&lt;base64 string&gt;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;mime_type&quot;</span>: <span class="string">&quot;image/jpeg&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line">response = model.invoke([message])</span><br><span class="line"></span><br><span class="line">message = HumanMessage(</span><br><span class="line">    content=[</span><br><span class="line">        &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Describe the weather in this image:&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;image_url&quot;</span>, <span class="string">&quot;image_url&quot;</span>: &#123;<span class="string">&quot;url&quot;</span>: image_url&#125;&#125;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line">response = model.invoke([message])</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Memory">Memory</h4>
<img src="/2025/04/21/AI-Agent/short-vs-long.png" class="" title="img">
<h5 id="çŸ­æœŸè®°å¿†">çŸ­æœŸè®°å¿†</h5>
<p>ä¼šè¯å†å²ç®¡ç†</p>
<h6 id="ç¼–è¾‘æ¶ˆæ¯åˆ—è¡¨">ç¼–è¾‘æ¶ˆæ¯åˆ—è¡¨</h6>
<p>èŠå¤©æ¨¡å‹é€šè¿‡æ¶ˆæ¯æ¥å—ä¸Šä¸‹æ–‡ï¼Œè¿™äº›æ¶ˆæ¯åŒ…æ‹¬å¼€å‘è€…æä¾›çš„æŒ‡ä»¤ï¼ˆç³»ç»Ÿæ¶ˆæ¯ï¼‰å’Œç”¨æˆ·è¾“å…¥ï¼ˆäººç±»æ¶ˆæ¯ï¼‰ã€‚åœ¨èŠå¤©åº”ç”¨ä¸­ï¼Œæ¶ˆæ¯åœ¨äººç±»è¾“å…¥å’Œæ¨¡å‹å“åº”ä¹‹é—´äº¤æ›¿ï¼Œå¯¼è‡´æ¶ˆæ¯åˆ—è¡¨éšç€æ—¶é—´çš„æ¨ç§»è€Œå˜é•¿ã€‚ç”±äºä¸Šä¸‹æ–‡çª—å£æœ‰é™ä¸”å¯Œæ ‡è®°çš„æ¶ˆæ¯åˆ—è¡¨å¯èƒ½æˆæœ¬é«˜æ˜‚ï¼Œè®¸å¤šåº”ç”¨å¯ä»¥ä»ä½¿ç”¨æ‰‹åŠ¨åˆ é™¤æˆ–å¿˜è®°è¿‡æ—¶ä¿¡æ¯çš„æŠ€æœ¯ä¸­å—ç›Šã€‚</p>
<img src="/2025/04/21/AI-Agent/filter.png" class="" title="img">
<p>æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä»åˆ—è¡¨ä¸­åˆ é™¤æ—§æ¶ˆæ¯ï¼ˆç±»ä¼¼äºæœ€è¿‘æœ€å°‘ä½¿ç”¨ç¼“å­˜ï¼‰</p>
<br>
<h6 id="æ€»ç»“è¿‡å¾€å¯¹è¯">æ€»ç»“è¿‡å¾€å¯¹è¯</h6>
<p>é—®é¢˜åœ¨äºä¿®å‰ªæˆ–åˆ é™¤æ¶ˆæ¯ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä»æ¶ˆæ¯é˜Ÿåˆ—çš„ç­›é€‰ä¸­ä¸¢å¤±ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸€äº›åº”ç”¨ç¨‹åºä»ä½¿ç”¨èŠå¤©æ¨¡å‹å¯¹æ¶ˆæ¯å†å²è¿›è¡Œæ›´å¤æ‚çš„æ€»ç»“æ–¹æ³•ä¸­å—ç›Šã€‚</p>
<img src="/2025/04/21/AI-Agent/summary.png" class="" title="img">
<br>
<h5 id="é•¿æœŸè®°å¿†">é•¿æœŸè®°å¿†</h5>
<h6 id="è®°å¿†å­˜å‚¨">è®°å¿†å­˜å‚¨</h6>
<p>é€šè¿‡{ï¼ˆç”¨æˆ·åï¼Œä¸Šä¸‹æ–‡ï¼‰ï¼šè®°å¿†}ä¿å­˜</p>
<br>
<h6 id="é•¿æœŸè®°å¿†æ€è€ƒæ¡†æ¶">é•¿æœŸè®°å¿†æ€è€ƒæ¡†æ¶</h6>
<br>
<h5 id="è®°å¿†ç±»å‹">è®°å¿†ç±»å‹</h5>
<ul>
<li>
<p>Semantic Memoryï¼š</p>
<p>è¯­ä¹‰è®°å¿†é€šå¸¸ç”¨äºé€šè¿‡è®°ä½è¿‡å»äº¤äº’ä¸­çš„äº‹å®æˆ–æ¦‚å¿µæ¥ä¸ªæ€§åŒ–åº”ç”¨ç¨‹åºã€‚ä¸ªæ€§åŒ–çš„è®°å¿†</p>
<p>ä¾‹å¦‚ä¸ªäººèµ„æ–™å’Œæ”¶è—</p>
</li>
<li>
<p>Episodic Memoryï¼š</p>
<p>æƒ…æ™¯è®°å¿†é€šå¸¸ç”¨äºå¸®åŠ©ä»£ç†è®°ä½å¦‚ä½•å®Œæˆä»»åŠ¡ã€‚</p>
</li>
<li>
<p>Procedural Memoryï¼š</p>
<p>ç¨‹åºæ€§è®°å¿†æ˜¯æ¨¡å‹æƒé‡ã€ä»£ç†ä»£ç å’Œä»£ç†æç¤ºçš„ç»„åˆï¼›</p>
<p>ä¸€èˆ¬ä»…ä¿®æ”¹ç³»ç»Ÿæç¤º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨å­˜å‚¨ä¸­çš„æŒ‡ä»¤æ¥è°ƒç”¨æ¨¡å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_model</span>(<span class="params">state: State, store: BaseStore</span>):</span><br><span class="line">    <span class="comment"># å®šä¹‰å‘½åç©ºé—´ï¼Œè¿™é‡Œä½¿ç”¨&quot;agent_instructions&quot;ä½œä¸ºå‘½åç©ºé—´</span></span><br><span class="line">    namespace = (<span class="string">&quot;agent_instructions&quot;</span>, )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä»å­˜å‚¨ä¸­è·å–é”®ä¸º&quot;agent_a&quot;çš„æŒ‡ä»¤æ•°æ®</span></span><br><span class="line">    <span class="comment"># [0]è¡¨ç¤ºè·å–æœç´¢ç»“æœçš„ç¬¬ä¸€é¡¹(å‡è®¾searchè¿”å›åˆ—è¡¨)</span></span><br><span class="line">    instructions = store.get(namespace, key=<span class="string">&quot;agent_a&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åº”ç”¨é€»è¾‘ï¼šä½¿ç”¨è·å–çš„æŒ‡ä»¤æ„å»ºæç¤ºè¯</span></span><br><span class="line">    <span class="comment"># prompt_templateæ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿ï¼ŒåŒ…å«&#123;instructions&#125;å ä½ç¬¦</span></span><br><span class="line">    prompt = prompt_template.<span class="built_in">format</span>(instructions=instructions.value[<span class="string">&quot;instructions&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿™é‡Œåº”è¯¥æœ‰è°ƒç”¨æ¨¡å‹ç­‰åç»­æ“ä½œ...</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹å‡½æ•°ï¼Œè¯¥å‡½æ•°æ›´æ–°å­˜å‚¨ä¸­çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_instructions</span>(<span class="params">state: State, store: BaseStore</span>):</span><br><span class="line">    <span class="comment"># å®šä¹‰å‘½åç©ºé—´ï¼Œè¿™é‡Œä½¿ç”¨&quot;instructions&quot;ä½œä¸ºå‘½åç©ºé—´</span></span><br><span class="line">    namespace = (<span class="string">&quot;instructions&quot;</span>,)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æœç´¢å½“å‰å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œå¹¶è·å–ç¬¬ä¸€ä¸ªç»“æœ</span></span><br><span class="line">    current_instructions = store.search(namespace)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®°å¿†é€»è¾‘ï¼šä½¿ç”¨å½“å‰æŒ‡ä»¤å’Œå¯¹è¯çŠ¶æ€æ„å»ºæç¤ºè¯</span></span><br><span class="line">    prompt = prompt_template.<span class="built_in">format</span>(</span><br><span class="line">        instructions=instructions.value[<span class="string">&quot;instructions&quot;</span>], </span><br><span class="line">        conversation=state[<span class="string">&quot;messages&quot;</span>]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è°ƒç”¨è¯­è¨€æ¨¡å‹è·å–è¾“å‡º</span></span><br><span class="line">    output = llm.invoke(prompt)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä»æ¨¡å‹è¾“å‡ºä¸­æå–æ–°çš„æŒ‡ä»¤</span></span><br><span class="line">    new_instructions = output[<span class="string">&#x27;new_instructions&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†æ–°æŒ‡ä»¤å­˜å‚¨åˆ°&quot;agent_instructions&quot;å‘½åç©ºé—´ä¸‹ï¼Œé”®ä¸º&quot;agent_a&quot;</span></span><br><span class="line">    store.put(</span><br><span class="line">        (<span class="string">&quot;agent_instructions&quot;</span>,),  <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line">        <span class="string">&quot;agent_a&quot;</span>,                <span class="comment"># é”®å</span></span><br><span class="line">        &#123;<span class="string">&quot;instructions&quot;</span>: new_instructions&#125;  <span class="comment"># å€¼(æ–°æŒ‡ä»¤)</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿™é‡Œå¯èƒ½æœ‰å…¶ä»–åç»­æ“ä½œ...</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<br>
<h5 id="è®°å¿†å†™å…¥">è®°å¿†å†™å…¥</h5>
<ul>
<li>
<p>çƒ­å†™å…¥</p>
</li>
<li>
<p>åå°å†™å…¥</p>
</li>
</ul>
<br>
<h4 id="Caching">Caching</h4>
<p>ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨è¯­ä¹‰ç¼“å­˜ï¼Œå³æ ¹æ®è¾“å…¥çš„æ„ä¹‰è€Œä¸æ˜¯ç²¾ç¡®è¾“å…¥æœ¬èº«æ¥ç¼“å­˜å“åº”ã€‚åœ¨æŸäº›æƒ…å†µä¸‹è¿™å¯èƒ½æœ‰æ•ˆï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹åˆ™ä¸ç„¶ã€‚</p>
<p>è¯­ä¹‰ç¼“å­˜å¼•å…¥äº†å¯¹åº”ç”¨ç¨‹åºå…³é”®è·¯å¾„ä¸Šå¦ä¸€ä¸ªæ¨¡å‹çš„ä¾èµ–ï¼ˆä¾‹å¦‚ï¼Œè¯­ä¹‰ç¼“å­˜å¯èƒ½ä¾èµ–äºåµŒå…¥æ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼‰ï¼Œå¹¶ä¸”æ— æ³•ä¿è¯å‡†ç¡®æ•æ‰è¾“å…¥çš„æ„ä¹‰ã€‚</p>
<p>ç„¶è€Œï¼Œå¯èƒ½å­˜åœ¨ä¸€äº›æƒ…å†µä¸‹ç¼“å­˜èŠå¤©æ¨¡å‹å“åº”æ˜¯æœ‰ç›Šçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªç”¨äºå›ç­”å¸¸è§é—®é¢˜çš„èŠå¤©æ¨¡å‹ï¼Œç¼“å­˜å“åº”å¯ä»¥å¸®åŠ©å‡è½»æ¨¡å‹æä¾›è€…çš„è´Ÿæ‹…ã€é™ä½æˆæœ¬å¹¶æé«˜å“åº”é€Ÿåº¦ã€‚</p>
<br>
<h3 id="Prompt">Prompt</h3>
<h4 id="PromptTemplate">PromptTemplate</h4>
<p>LangChain æä¾›äº† <code>PromptTemplate</code> æ¨¡å—ç”¨äºåŠ¨æ€åœ°æ„å»ºæç¤ºè¯ï¼ˆPromptï¼‰ã€‚å®ƒæ”¯æŒå˜é‡æ›¿æ¢ï¼Œè®©å¼€å‘è€…èƒ½çµæ´»æ„é€ æç¤ºè¯­å¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line">template = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;product&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;è¯·ä¸ºä»¥ä¸‹äº§å“å†™ä¸€æ®µå¹¿å‘Šæ–‡æ¡ˆï¼š&#123;product&#125;&quot;</span></span><br><span class="line">)</span><br><span class="line">prompt = template.<span class="built_in">format</span>(product=<span class="string">&quot;æ™ºèƒ½æ‰‹è¡¨&quot;</span>)</span><br></pre></td></tr></table></figure>
<br>
<h3 id="Semantic-search-engine">Semantic search engine</h3>
<p>LangChain éå¸¸é€‚åˆæ„å»ºåŸºäºçŸ¥è¯†åº“çš„é—®ç­”ç³»ç»Ÿï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š</p>
<h4 id="Chunking">Chunking</h4>
<p>å°†é•¿æ–‡æ¡£æŒ‰æ®µè½æˆ– token é™åˆ¶æ‹†åˆ†ä¸ºå°å—ï¼ˆchunkï¼‰ï¼Œä»¥é¿å…è¾“å…¥è¶…é•¿ã€‚</p>
<p><code>RecursiveCharacterTextSplitter</code> é€šè¿‡<strong>é€’å½’å°è¯•ä¸åŒçš„åˆ†éš”ç¬¦å±‚çº§</strong>ï¼Œé€æ­¥å°†æ–‡æœ¬åˆ†å‰²ä¸ºè¯­ä¹‰è¿è´¯çš„å—ã€‚å®ƒä¼˜å…ˆå°è¯•æ›´é«˜çº§åˆ«çš„åˆ†éš”ç¬¦ï¼ˆå¦‚æ®µè½ï¼‰ï¼Œå¦‚æœåˆ†å‰²åçš„å—ä»è¿‡å¤§ï¼Œåˆ™é€’å½’ä½¿ç”¨æ›´ä½çº§åˆ«çš„åˆ†éš”ç¬¦ï¼ˆå¦‚å¥å­ã€å•è¯ï¼‰è¿›è¡ŒäºŒæ¬¡åˆ†å‰²ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">500</span>, chunk_overlap=<span class="number">50</span>)</span><br><span class="line">chunks = splitter.split_text(document_text)</span><br></pre></td></tr></table></figure>
<br>
<h5 id="Better-Chunking">Better Chunking</h5>
<p>ref: <a target="_blank" rel="noopener" href="https://github.com/ConardLi/easy-dataset">https://github.com/ConardLi/easy-dataset</a></p>
<ol>
<li>é¦–å…ˆéœ€è¦è®¾å®šæ–‡æœ¬å—çš„æœ€å°ï¼Œæœ€å¤§åˆ†å‰²é•¿åº¦</li>
<li>è‡ªåŠ¨å¯¹ç« èŠ‚ï¼ˆMarkdownæ–‡ä»¶ä¸­çš„ <code>#, ##, ###</code>ï¼‰è¿›è¡Œè¯†åˆ«</li>
<li>å¯¹å·²è¯†åˆ«åˆ°çš„ç« èŠ‚å­—æ•°è¿›è¡Œè®¡æ•°ï¼Œåœ¨æ°å¥½ä½äº &gt; æœ€å°åˆ†å‰²é•¿åº¦ å’Œ &lt; æœ€å¤§åˆ†å‰²é•¿åº¦çš„å‰æä¸‹è¿›è¡Œåˆ†æ®µ</li>
<li>é‡åˆ°é•¿æ®µè½ï¼ˆè¶…å‡ºæœ€å¤§åˆ†å‰²é•¿åº¦ï¼‰æ—¶ï¼Œæ‰§è¡Œé€’å½’åˆ†æ®µç®—æ³• <code>RecursiveCharacterTextSplitter</code>ï¼›</li>
</ol>
<blockquote>
<p>å…¶å®å°±æ˜¯åŠ äº†ä¸€ä¸ªå¯¹ç« èŠ‚çš„è¯†åˆ«åˆ†å‰²</p>
</blockquote>
<br>
<h4 id="Embedding-Vector-Store">Embedding &amp; Vector Store</h4>
<p>ä½¿ç”¨ Embedding æ¨¡å‹ï¼ˆå¦‚ OpenAIã€HuggingFaceï¼‰å°†æ–‡æœ¬å‘é‡åŒ–ï¼Œç„¶åå­˜å…¥å‘é‡æ•°æ®åº“ï¼ˆå¦‚ FAISSã€Chromaã€Pineconeï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"></span><br><span class="line">embeddings = OpenAIEmbeddings(model=<span class="string">&quot;text-embedding-3-large&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># FAISSå­˜å‚¨</span></span><br><span class="line">embedding_dim = <span class="built_in">len</span>(embeddings.embed_query(<span class="string">&quot;hello world&quot;</span>))</span><br><span class="line">index = faiss.IndexFlatL2(embedding_dim)</span><br><span class="line"></span><br><span class="line">vector_store = FAISS(</span><br><span class="line">    embedding_function=embeddings,</span><br><span class="line">    index=index,</span><br><span class="line">    docstore=InMemoryDocstore(),</span><br><span class="line">    index_to_docstore_id=&#123;&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ids = vector_store.add_documents(documents=all_splits)</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Retrieval">Retrieval</h4>
<p>ä½¿ç”¨å‘é‡æ£€ç´¢è·å–ç›¸å…³ chunkï¼Œè¾“å…¥ç»™ LLMï¼Œç”Ÿæˆç­”æ¡ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.documents <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@chain</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">retriever</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[Document]:</span><br><span class="line">    <span class="keyword">return</span> vector_store.similarity_search(query, k=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">retriever.batch(</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&quot;How many distribution centers does Nike have in the US?&quot;</span>,</span><br><span class="line">        <span class="string">&quot;When was Nike incorporated?&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<br>
<br>
<h3 id="Agent">Agent</h3>
<p>Agent æ˜¯ LangChain ä¸­å®ç° LLM æ¨ç†å’Œå†³ç­–çš„æ ¸å¿ƒæ¨¡å—ï¼Œæ”¯æŒåŠ¨æ€é€‰æ‹©å·¥å…·ï¼ˆToolï¼‰æ¥å®Œæˆå¤šæ­¥ä»»åŠ¡ã€‚</p>
<h4 id="Base">Base</h4>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>Agent</strong>ï¼šè´Ÿè´£æ¨ç†å’Œè°ƒç”¨å·¥å…·</li>
<li><strong>Tool</strong>ï¼šå·¥å…·å‡½æ•°ï¼Œå¦‚ Web æœç´¢ã€æ•°æ®åº“æŸ¥è¯¢ã€Python è®¡ç®—ç­‰</li>
<li><strong>LLM</strong>ï¼šé©±åŠ¨ Agent çš„å¤§è„‘</li>
<li><strong>AgentExecutor</strong>ï¼šæ‰§è¡Œå™¨ï¼Œè´Ÿè´£ç®¡ç† Agent çš„æ‰§è¡Œé€»è¾‘</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import relevant functionality</span></span><br><span class="line"><span class="keyword">from</span> langchain_anthropic <span class="keyword">import</span> ChatAnthropic</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> create_react_agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the agent</span></span><br><span class="line">memory = MemorySaver()</span><br><span class="line">model = ChatAnthropic(model_name=<span class="string">&quot;claude-3-sonnet-20240229&quot;</span>)</span><br><span class="line">search = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [search]</span><br><span class="line">agent_executor = create_react_agent(model, tools, checkpointer=memory)</span><br></pre></td></tr></table></figure>
<br>
<h4 id="QA-Processing-Method">QA Processing Method</h4>
<p>Stuff Methodï¼ˆå¡å…¥å¼ï¼‰</p>
<p>ç›´æ¥å°†æ‰€æœ‰ç›¸å…³æ–‡æ¡£çš„å†…å®¹â€œå¡â€è¿› Prompt é‡Œï¼Œé€‚ç”¨äºå†…å®¹å°‘ã€ä¸Šä¸‹æ–‡çŸ­çš„åœºæ™¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LLMChain + æ–‡æ¡£ç»„åˆç›´æ¥ç”Ÿæˆ Prompt</span></span><br></pre></td></tr></table></figure>
<p>MapReduce</p>
<p>å°†æ‰€æœ‰ chunk åˆ†åˆ«ç”¨ LLM å¤„ç†åï¼Œå†ç”¨å¦ä¸€ä¸ª LLM æ±‡æ€»ï¼ˆReduceï¼‰ï¼Œç±»ä¼¼ MapReduce æ€ç»´ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡æ¡£åˆ‡ç‰‡ -&gt; å„ç‰‡æ®µç”Ÿæˆå›ç­”ï¼ˆMapï¼‰-&gt; æ±‡æ€»ä¸ºæœ€ç»ˆç­”æ¡ˆï¼ˆReduceï¼‰</span></span><br></pre></td></tr></table></figure>
<p>Refine</p>
<p>åˆå§‹æ–‡æ¡£å›ç­”ä¸€ä¸ªç²—ç•¥ç­”æ¡ˆï¼Œæ¥ç€é€æ­¥å¼•å…¥æ›´å¤š chunk æ¥ç»†åŒ–å’Œå®Œå–„ç­”æ¡ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆæ­¥å›ç­” + åç»­ refineï¼Œé€‚åˆé€æ­¥æ·±å…¥å¤„ç†</span></span><br></pre></td></tr></table></figure>
<p>MapRerank</p>
<p>ç±»ä¼¼ Map æ–¹æ³•ï¼Œä½†æœ€åä¸æ±‡æ€»æ‰€æœ‰å›ç­”ï¼Œè€Œæ˜¯ç”± LLM å¯¹æ¯ä¸ªå›ç­”æ‰“åˆ†ï¼Œé€‰æ‹©æœ€ä¼˜ç­”æ¡ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤šä¸ªå›ç­” -&gt; æ‰“åˆ†æ’åº -&gt; è¿”å›æœ€é«˜åˆ†</span></span><br></pre></td></tr></table></figure>
<br>
<h4 id="Streaming-message-Streaming-tokens">Streaming message &amp; Streaming tokens</h4>
<p><strong>streaming tokens</strong></p>
<p>æŒ‡é€ä¸ªç”Ÿæˆæ–‡æœ¬ç‰‡æ®µï¼ˆTokenï¼‰ï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶å±•ç¤ºç”Ÿæˆè¿‡ç¨‹çš„åœºæ™¯ï¼Œå¦‚é€è¯æ˜¾ç¤ºå›ç­”ã€‚</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">model = ChatOpenAI(model=<span class="string">&quot;gpt-4o-mini&quot;</span>, streaming=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åŒæ­¥æµå¼å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> model.stream(<span class="string">&quot;å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(chunk.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºæ•ˆæœï¼š<br>
<code>The| sky| appears| blue| during| the| day|.</code></p>
<br>
<p><strong>Streaming Messages</strong></p>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ <code>.invoke</code> æ¥è°ƒç”¨ä»£ç†ä»¥è·å–æœ€ç»ˆå“åº”ã€‚å¦‚æœä»£ç†æ‰§è¡Œå¤šä¸ªæ­¥éª¤ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚ä¸ºäº†å±•ç¤ºä¸­é—´è¿›åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ¶ˆæ¯å‘ç”Ÿæ—¶å®æ—¶è¿”å›æ¶ˆæ¯ã€‚</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> agent_executor.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(content=<span class="string">&quot;whats the weather in sf?&quot;</span>)]&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    step[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">whats the weather <span class="keyword">in</span> sf?</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Okay, let me look up the current weather for San Francisco using a search engine:&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;text&#x27;</span>&#125;, &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;toolu_01H1brh5EZpZqtqHBxkosPtN&#x27;</span>, <span class="string">&#x27;input&#x27;</span>: &#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;san francisco weather&#x27;</span>&#125;, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tavily_search_results_json&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_use&#x27;</span>&#125;]</span><br><span class="line">Tool Calls:</span><br><span class="line">  tavily_search_results_json (toolu_01H1brh5EZpZqtqHBxkosPtN)</span><br><span class="line"> Call ID: toolu_01H1brh5EZpZqtqHBxkosPtN</span><br><span class="line">  Args:</span><br><span class="line">    query: san francisco weather</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: tavily_search_results_json</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://www.weatherapi.com/&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;&#123;&#x27;location&#x27;: &#123;&#x27;name&#x27;: &#x27;San Francisco&#x27;, &#x27;region&#x27;: &#x27;California&#x27;, &#x27;country&#x27;: &#x27;United States of America&#x27;, &#x27;lat&#x27;: 37.775, &#x27;lon&#x27;: -122.4183, &#x27;tz_id&#x27;: &#x27;America/Los_Angeles&#x27;, &#x27;localtime_epoch&#x27;: 1739994486, &#x27;localtime&#x27;: &#x27;2025-02-19 11:48&#x27;&#125;, &#x27;current&#x27;: &#123;&#x27;last_updated_epoch&#x27;: 1739994300, &#x27;last_updated&#x27;: &#x27;2025-02-19 11:45&#x27;, &#x27;temp_c&#x27;: 13.3, &#x27;temp_f&#x27;: 55.9, &#x27;is_day&#x27;: 1, &#x27;condition&#x27;: &#123;&#x27;text&#x27;: &#x27;Light rain&#x27;, &#x27;icon&#x27;: &#x27;//cdn.weatherapi.com/weather/64x64/day/296.png&#x27;, &#x27;code&#x27;: 1183&#125;, &#x27;wind_mph&#x27;: 5.8, &#x27;wind_kph&#x27;: 9.4, &#x27;wind_degree&#x27;: 195, &#x27;wind_dir&#x27;: &#x27;SSW&#x27;, &#x27;pressure_mb&#x27;: 1023.0, &#x27;pressure_in&#x27;: 30.2, &#x27;precip_mm&#x27;: 0.0, &#x27;precip_in&#x27;: 0.0, &#x27;humidity&#x27;: 87, &#x27;cloud&#x27;: 100, &#x27;feelslike_c&#x27;: 12.7, &#x27;feelslike_f&#x27;: 54.8, &#x27;windchill_c&#x27;: 9.1, &#x27;windchill_f&#x27;: 48.4, &#x27;heatindex_c&#x27;: 10.2, &#x27;heatindex_f&#x27;: 50.3, &#x27;dewpoint_c&#x27;: 9.8, &#x27;dewpoint_f&#x27;: 49.7, &#x27;vis_km&#x27;: 4.0, &#x27;vis_miles&#x27;: 2.0, &#x27;uv&#x27;: 1.4, &#x27;gust_mph&#x27;: 8.9, &#x27;gust_kph&#x27;: 14.4&#125;&#125;&quot;</span>&#125;, &#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://world-weather.info/forecast/usa/san_francisco/february-2025/&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Weather in San Francisco in February 2025 (California) - Detailed Weather Forecast for a Month Weather World Weather in San Francisco Weather in San Francisco in February 2025 San Francisco Weather Forecast for February 2025, is based on previous years&#x27; statistical data. +59Â°+50Â° +59Â°+52Â° +59Â°+50Â° +61Â°+52Â° +59Â°+50Â° +61Â°+50Â° +61Â°+52Â° +63Â°+52Â° +61Â°+52Â° +61Â°+50Â° +61Â°+50Â° +61Â°+50Â° +59Â°+50Â° +59Â°+50Â° +61Â°+50Â° +61Â°+52Â° +59Â°+50Â° +59Â°+48Â° +57Â°+48Â° +59Â°+50Â° +59Â°+48Â° +59Â°+50Â° +57Â°+46Â° +61Â°+50Â° +61Â°+50Â° +59Â°+50Â° +59Â°+48Â° +59Â°+50Â° Extended weather forecast in San Francisco HourlyWeek10-Day14-Day30-DayYear Weather in large and nearby cities Weather in Washington, D.C.+41Â° Sacramento+55Â° Pleasanton+55Â° Redwood City+55Â° San Leandro+55Â° San Mateo+54Â° San Rafael+52Â° San Ramon+52Â° South San Francisco+54Â° Vallejo+50Â° Palo Alto+55Â° Pacifica+55Â° Berkeley+54Â° Castro Valley+55Â° Concord+52Â° Daly City+54Â° Noverd+52Â° Sign Hill+54Â° world&#x27;s temperature today day day Temperature units&quot;</span>&#125;]</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">The search results provide details on the current weather conditions and forecast <span class="keyword">for</span> San Francisco. Some key details:</span><br><span class="line"></span><br><span class="line">- It is lightly raining <span class="keyword">in</span> San Francisco right now, with a temperature around 55Â°F/13Â°C. </span><br><span class="line">- The forecast <span class="keyword">for</span> the rest of February 2025 shows daytime highs mostly <span class="keyword">in</span> the upper 50s to low 60s F, with night lows <span class="keyword">in</span> the upper 40s to low 50s F. </span><br><span class="line">- Typical weather includes some rain, clouds, cool temperatures and breezy conditions.</span><br><span class="line"></span><br><span class="line">So <span class="keyword">in</span> summary, as is common <span class="keyword">for</span> San Francisco <span class="keyword">in</span> late winter, it is currently cool with light rain showers, and similar mild, unsettled weather is expected over the next couple weeks. Layers and a light jacket would be advisable <span class="keyword">for</span> being outdoors. Let me know <span class="keyword">if</span> you need any other details!</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Memory-Adding">Memory Adding</h4>
<p>é€šè¿‡configå®ç°å¯¹çº¿ç¨‹ä¸Šä¸‹æ–‡çš„è®°å¿†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">agent_executor = create_react_agent(model, tools, checkpointer=memory)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;abc123&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> agent_executor.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(content=<span class="string">&quot;hi im bob!&quot;</span>)]&#125;, config</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(chunk)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;agent&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&quot;Hello Bob! It&#x27;s nice to meet you again.&quot;</span>, response_metadata=&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;msg_013C1z2ZySagEFwmU1EsysR2&#x27;</span>, <span class="string">&#x27;model&#x27;</span>: <span class="string">&#x27;claude-3-sonnet-20240229&#x27;</span>, <span class="string">&#x27;stop_reason&#x27;</span>: <span class="string">&#x27;end_turn&#x27;</span>, <span class="string">&#x27;stop_sequence&#x27;</span>: None, <span class="string">&#x27;usage&#x27;</span>: &#123;<span class="string">&#x27;input_tokens&#x27;</span>: 1162, <span class="string">&#x27;output_tokens&#x27;</span>: 14&#125;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run-f878acfd-d195-44e8-9166-e2796317e3f8-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: 1162, <span class="string">&#x27;output_tokens&#x27;</span>: 14, <span class="string">&#x27;total_tokens&#x27;</span>: 1176&#125;)]&#125;&#125;</span><br><span class="line">----</span><br></pre></td></tr></table></figure>
<p>å°è¯•ä¸Šä¸‹æ–‡è®°å¿†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> agent_executor.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [HumanMessage(content=<span class="string">&quot;whats my name?&quot;</span>)]&#125;, config</span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(chunk)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;agent&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;You mentioned your name is Bob when you introduced yourself earlier. So your name is Bob.&#x27;</span>, response_metadata=&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;msg_01WNwnRNGwGDRw6vRdivt6i1&#x27;</span>, <span class="string">&#x27;model&#x27;</span>: <span class="string">&#x27;claude-3-sonnet-20240229&#x27;</span>, <span class="string">&#x27;stop_reason&#x27;</span>: <span class="string">&#x27;end_turn&#x27;</span>, <span class="string">&#x27;stop_sequence&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;usage&#x27;</span>: &#123;<span class="string">&#x27;input_tokens&#x27;</span>: <span class="number">1184</span>, <span class="string">&#x27;output_tokens&#x27;</span>: <span class="number">21</span>&#125;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run-f5c0b957-8878-405a-9d4b-a7cd38efe81f-0&#x27;</span>, usage_metadata=&#123;<span class="string">&#x27;input_tokens&#x27;</span>: <span class="number">1184</span>, <span class="string">&#x27;output_tokens&#x27;</span>: <span class="number">21</span>, <span class="string">&#x27;total_tokens&#x27;</span>: <span class="number">1205</span>&#125;)]&#125;&#125;</span><br><span class="line">----</span><br></pre></td></tr></table></figure>
<br>
<h3 id="Example">Example</h3>
<h4 id="Extraction-Chain">Extraction Chain</h4>
<h5 id="Schema-Extrator">Schema &amp; Extrator</h5>
<p>Schema æè¿°å¦‚ä½•ä»æ–‡æœ¬ä¸­æå–ä¿¡æ¯ï¼Œé€šè¿‡ç»“æ„åŒ–æŒ‡å®š + prompt invokeå®ç°ä¿¡æ¯æå–</p>
<blockquote>
<p>å…³äº pydantic åº“çš„ä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="comment"># å¿…å¡«å­—æ®µï¼Œå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¯é€‰å­—æ®µï¼Œå¸¦æœ‰é»˜è®¤å€¼</span></span><br><span class="line">    age: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½¿ç”¨ Field æ·»åŠ é¢å¤–éªŒè¯å’Œå…ƒæ•°æ®</span></span><br><span class="line">    email: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,  <span class="comment"># è¡¨ç¤ºå¿…å¡«å­—æ®µ</span></span><br><span class="line">        min_length=<span class="number">5</span>,</span><br><span class="line">        max_length=<span class="number">100</span>,</span><br><span class="line">        regex=<span class="string">r&quot;^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¸¦æœ‰é»˜è®¤å€¼å’Œé¢å¤–éªŒè¯çš„å­—æ®µ</span></span><br><span class="line">    score: <span class="built_in">float</span> = Field(</span><br><span class="line">        default=<span class="number">0.0</span>,</span><br><span class="line">        ge=<span class="number">0</span>,</span><br><span class="line">        le=<span class="number">100</span>,</span><br><span class="line">        description=<span class="string">&quot;ç”¨æˆ·è¯„åˆ†ï¼ŒèŒƒå›´0-100&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ«åç¤ºä¾‹</span></span><br><span class="line">    full_name: <span class="built_in">str</span> = Field(..., alias=<span class="string">&quot;fullName&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ¨¡å‹</span></span><br><span class="line">user_data = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;john_doe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="string">&quot;john@example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fullName&quot;</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = User(**user_data)</span><br><span class="line"><span class="built_in">print</span>(user)</span><br><span class="line"><span class="comment"># è¾“å‡º: username=&#x27;john_doe&#x27; age=None email=&#x27;john@example.com&#x27; score=0.0 full_name=&#x27;John Doe&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(user.<span class="built_in">dict</span>(by_alias=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># è¾“å‡º: &#123;&#x27;username&#x27;: &#x27;john_doe&#x27;, &#x27;age&#x27;: None, &#x27;email&#x27;: &#x27;john@example.com&#x27;, &#x27;score&#x27;: 0.0, &#x27;fullName&#x27;: &#x27;John Doe&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>default</code>: å­—æ®µçš„é»˜è®¤å€¼</li>
<li><code>default_factory</code>: ç”Ÿæˆé»˜è®¤å€¼çš„å¯è°ƒç”¨å¯¹è±¡</li>
<li><code>alias</code>: å­—æ®µçš„åˆ«åï¼ˆç”¨äºåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼‰</li>
<li><code>title</code>: å­—æ®µçš„æ ‡é¢˜ï¼ˆç”¨äºæ–‡æ¡£ï¼‰</li>
<li><code>description</code>: å­—æ®µçš„æè¿°ï¼ˆç”¨äºæ–‡æ¡£ï¼‰</li>
<li><code>gt</code>: å¤§äº (greater than)</li>
<li><code>ge</code>: å¤§äºç­‰äº (greater than or equal)</li>
<li><code>lt</code>: å°äº (less than)</li>
<li><code>le</code>: å°äºç­‰äº (less than or equal)</li>
<li><code>min_length</code>: æœ€å°é•¿åº¦ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ç­‰ï¼‰</li>
<li><code>max_length</code>: æœ€å¤§é•¿åº¦ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ç­‰ï¼‰</li>
<li><code>regex</code>: æ­£åˆ™è¡¨è¾¾å¼éªŒè¯</li>
</ul>
</blockquote>
<br>
<p>æ¡ˆä¾‹ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Information about a person.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ^ Doc-string for the entity Person.</span></span><br><span class="line">    <span class="comment"># This doc-string is sent to the LLM as the description of the schema Person,</span></span><br><span class="line">    <span class="comment"># and it can help to improve extraction results.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Note that:</span></span><br><span class="line">    <span class="comment"># 1. Each field is an `optional` -- this allows the model to decline to extract it!</span></span><br><span class="line">    <span class="comment"># 2. Each field has a `description` -- this description is used by the LLM.</span></span><br><span class="line">    <span class="comment"># Having a good description can help improve extraction results.</span></span><br><span class="line">    name: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(default=<span class="literal">None</span>, description=<span class="string">&quot;The name of the person&quot;</span>)</span><br><span class="line">    hair_color: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(</span><br><span class="line">        default=<span class="literal">None</span>, description=<span class="string">&quot;The color of the person&#x27;s hair if known&quot;</span></span><br><span class="line">    )</span><br><span class="line">    height_in_meters: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(</span><br><span class="line">        default=<span class="literal">None</span>, description=<span class="string">&quot;Height measured in meters&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Extracted data about people.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Creates a model so that we can extract multiple entities.</span></span><br><span class="line">    people: <span class="type">List</span>[Person]        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># ä¸ºLLMè®¾ç½®schema</span></span><br><span class="line"><span class="comment"># structured_llm = llm.with_structured_output(schema=Person)</span></span><br><span class="line"></span><br><span class="line">structured_llm = llm.with_structured_output(schema=Data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a custom prompt to provide instructions and any additional context.</span></span><br><span class="line"><span class="comment"># 1) You can add examples into the prompt template to improve extraction quality</span></span><br><span class="line"><span class="comment"># 2) Introduce additional parameters to take context into account (e.g., include metadata</span></span><br><span class="line"><span class="comment">#    about the document from which the text was extracted.)</span></span><br><span class="line">prompt_template = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;You are an expert extraction algorithm. &quot;</span></span><br><span class="line">            <span class="string">&quot;Only extract relevant information from the text. &quot;</span></span><br><span class="line">            <span class="string">&quot;If you do not know the value of an attribute asked to extract, &quot;</span></span><br><span class="line">            <span class="string">&quot;return null for the attribute&#x27;s value.&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment"># Please see the how-to about improving performance with</span></span><br><span class="line">        <span class="comment"># reference examples.</span></span><br><span class="line">        <span class="comment"># MessagesPlaceholder(&#x27;examples&#x27;),</span></span><br><span class="line">        (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;text&#125;&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;My name is Jeff, my hair is black and i am 6 feet tall. Anna has the same color hair as me.&quot;</span></span><br><span class="line">prompt = prompt_template.invoke(&#123;<span class="string">&quot;text&quot;</span>: text&#125;)</span><br><span class="line">structured_llm.invoke(prompt)</span><br></pre></td></tr></table></figure>
<br>
<p>output</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Data(people=[Person(name=<span class="string">&#x27;Jeff&#x27;</span>, hair_color=<span class="string">&#x27;black&#x27;</span>, height_in_meters=<span class="string">&#x27;1.83&#x27;</span>), Person(name=<span class="string">&#x27;Anna&#x27;</span>, hair_color=<span class="string">&#x27;black&#x27;</span>, height_in_meters=None)])</span><br></pre></td></tr></table></figure>
<br>
<h5 id="RAG-based-long-context-extraction">RAG based long context extraction</h5>
<p>ä½¿ç”¨ FAISS</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KeyDevelopment</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Information about a development in the history of cars.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    year: <span class="built_in">int</span> = Field(</span><br><span class="line">        ...,  <span class="comment"># `...` è¡¨ç¤ºå¿…å¡«å­—æ®µ</span></span><br><span class="line">        description=<span class="string">&quot;The year when there was an important historic development.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    description: <span class="built_in">str</span> = Field(</span><br><span class="line">        ..., </span><br><span class="line">        description=<span class="string">&quot;What happened in this year? What was the development?&quot;</span></span><br><span class="line">    )</span><br><span class="line">    evidence: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        description=<span class="string">&quot;Repeat verbatim the sentence(s) from which the year and description were extracted.&quot;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtractionData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Extracted information about key developments in the history of cars.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    key_developments: <span class="type">List</span>[KeyDevelopment]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a custom prompt to provide instructions and any additional context.</span></span><br><span class="line"><span class="comment"># 1) You can add examples into the prompt template to improve extraction quality</span></span><br><span class="line"><span class="comment"># 2) Introduce additional parameters to take context into account (e.g., include metadata</span></span><br><span class="line"><span class="comment">#    about the document from which the text was extracted.)</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;You are an expert at identifying key historic development in text. &quot;</span></span><br><span class="line">            <span class="string">&quot;Only extract important historic developments. Extract nothing if no important information can be found in the text.&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;text&#125;&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥å¿…è¦çš„åº“å’Œæ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> FAISS  <span class="comment"># FAISSå‘é‡æ•°æ®åº“ï¼Œç”¨äºé«˜æ•ˆç›¸ä¼¼æ€§æœç´¢</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.documents <span class="keyword">import</span> Document      <span class="comment"># æ–‡æ¡£å¤„ç†åŸºç¡€ç±»</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnableLambda <span class="comment"># å¯è¿è¡ŒLambdaå‡½æ•°</span></span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings     <span class="comment"># OpenAIçš„æ–‡æœ¬åµŒå…¥æ¨¡å‹</span></span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> CharacterTextSplitter  <span class="comment"># æ–‡æœ¬åˆ†å‰²å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–‡æœ¬åˆ†å‰²å™¨å°†æ–‡æ¡£å†…å®¹åˆ†å‰²æˆå¤šä¸ªæ–‡æœ¬å—</span></span><br><span class="line"><span class="comment"># document.page_contentæ˜¯åŸå§‹æ–‡æ¡£å†…å®¹</span></span><br><span class="line">texts = text_splitter.split_text(document.page_content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨FAISSåˆ›å»ºå‘é‡å­˜å‚¨åº“</span></span><br><span class="line"><span class="comment"># å°†åˆ†å‰²åçš„æ–‡æœ¬å—(texts)è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œä½¿ç”¨OpenAIçš„åµŒå…¥æ¨¡å‹</span></span><br><span class="line">vectorstore = FAISS.from_texts(texts, embedding=OpenAIEmbeddings())</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ£€ç´¢å™¨(retriever)ï¼Œç”¨äºä»å‘é‡åº“ä¸­æ£€ç´¢ç›¸å…³æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># search_kwargs=&#123;&quot;k&quot;: 1&#125; è¡¨ç¤ºåªè¿”å›æœ€ç›¸å…³çš„1ä¸ªæ–‡æ¡£</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">1</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">extractor = prompt | llm.with_structured_output(</span><br><span class="line">    schema=ExtractionData,</span><br><span class="line">    include_raw=<span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºRAG(æ£€ç´¢å¢å¼ºç”Ÿæˆ)æå–å™¨</span></span><br><span class="line"><span class="comment"># 1. é¦–å…ˆä½¿ç”¨retrieveræ£€ç´¢æ–‡æ¡£</span></span><br><span class="line"><span class="comment"># 2. ç„¶åé€šè¿‡Lambdaå‡½æ•°æå–ç¬¬ä¸€ä¸ªæ–‡æ¡£çš„å†…å®¹(docs[0].page_content)</span></span><br><span class="line"><span class="comment"># 3. æœ€åå°†æå–çš„æ–‡æœ¬ä¼ é€’ç»™extractorè¿›è¡Œå¤„ç†</span></span><br><span class="line">rag_extractor = &#123;</span><br><span class="line">    <span class="string">&quot;text&quot;</span>: retriever | (<span class="keyword">lambda</span> docs: docs[<span class="number">0</span>].page_content)</span><br><span class="line">&#125; | extractor</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨RAGæå–å™¨ï¼ŒæŸ¥è¯¢&quot;ä¸æ±½è½¦ç›¸å…³çš„å…³é”®å‘å±•&quot;</span></span><br><span class="line"><span class="comment"># ç³»ç»Ÿä¼šå…ˆæ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œç„¶åæå–ä¿¡æ¯</span></span><br><span class="line">results = rag_extractor.invoke(<span class="string">&quot;Key developments associated with cars&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†å¹¶æ‰“å°æå–å‡ºçš„æ¯ä¸ªå…³é”®å‘å±•</span></span><br><span class="line"><span class="keyword">for</span> key_development <span class="keyword">in</span> results.key_developments:</span><br><span class="line">    <span class="built_in">print</span>(key_development)</span><br></pre></td></tr></table></figure>
<br>
<h4 id="Classify">Classify</h4>
<p>æ¡ˆä¾‹ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Classification</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    sentiment: <span class="built_in">str</span> = Field(..., enum=[<span class="string">&quot;happy&quot;</span>, <span class="string">&quot;neutral&quot;</span>, <span class="string">&quot;sad&quot;</span>])</span><br><span class="line">    aggressiveness: <span class="built_in">int</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        description=<span class="string">&quot;describes how aggressive the statement is, the higher the number the more aggressive&quot;</span>,</span><br><span class="line">        enum=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    )</span><br><span class="line">    language: <span class="built_in">str</span> = Field(</span><br><span class="line">        ..., enum=[<span class="string">&quot;spanish&quot;</span>, <span class="string">&quot;english&quot;</span>, <span class="string">&quot;french&quot;</span>, <span class="string">&quot;german&quot;</span>, <span class="string">&quot;italian&quot;</span>]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tagging_prompt = ChatPromptTemplate.from_template(</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Extract the desired information from the following passage.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Only extract the properties mentioned in the &#x27;Classification&#x27; function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Passage:</span></span><br><span class="line"><span class="string">&#123;input&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># LLM</span></span><br><span class="line">llm = ChatOpenAI(temperature=<span class="number">0</span>, model=<span class="string">&quot;gpt-4o-mini&quot;</span>).with_structured_output(</span><br><span class="line">    Classification</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">inp = <span class="string">&quot;Estoy increiblemente contento de haberte conocido! Creo que seremos muy buenos amigos!&quot;</span></span><br><span class="line">prompt = tagging_prompt.invoke(&#123;<span class="string">&quot;input&quot;</span>: inp&#125;)</span><br><span class="line">response = llm.invoke(prompt)</span><br><span class="line"></span><br><span class="line">response</span><br><span class="line"><span class="comment"># output: </span></span><br><span class="line"><span class="comment"># Classification(sentiment=&#x27;positive&#x27;, aggressiveness=1, language=&#x27;Spanish&#x27;)</span></span><br><span class="line">response.model_dump()  <span class="comment"># dictionary output</span></span><br><span class="line"><span class="comment"># output: </span></span><br><span class="line"><span class="comment"># sentiment=&#x27;positive&#x27;, aggressiveness=1, language=&#x27;Spanish&#x27;</span></span><br></pre></td></tr></table></figure>
<br>
<h2 id="LangGraph">LangGraph</h2>
<h3 id="Graph">Graph</h3>
<p>Graph ç”± nodes å’Œ edge æ„æˆ</p>
<p>state ä¸ºæ¯ä¸ªå›¾çš„ contextï¼Œåœ¨å®šä¹‰å›¾æ—¶ä¼ å…¥ï¼›</p>
<p>æ¯ä¸ª <code>node</code> éƒ½å¯ä»¥æ¥æ”¶å½“å‰çš„ <code>State</code> ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºçŠ¶æ€æ›´æ–°ã€‚</p>
<p>The <code>State</code> includes the graphâ€™s schema and <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/low_level/#reducers">reducer functions</a> that handle state updates.</p>
<br>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong></p>
<p><code>add_node</code></p>
<ul>
<li>
<p>é€šè¿‡ <code>.add_node(str, node)</code> æ·»åŠ èŠ‚ç‚¹åˆ°å›¾ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå”¯ä¸€èŠ‚ç‚¹åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºèŠ‚ç‚¹è¢«ä½¿ç”¨æ—¶æ‰€è°ƒç”¨çš„å‡½æ•°æˆ–å¯¹è±¡ï¼›</p>
<blockquote>
<p>æ¯ä¸ªnodeç›¸å½“äºä¸€ä¸ªå¯æ‰§è¡Œå‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…åšä»»ä½•äº‹æƒ…</p>
</blockquote>
</li>
</ul>
<br>
<p><code>add_edge</code></p>
<ul>
<li>é€šè¿‡ <code>.add_edge(START, str)</code> å’Œ <code>.add_edge(node, str)</code> æ·»åŠ  <code>entry</code> point å’Œ <code>finish</code> pointï¼ŒæŒ‡åå›¾çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œstr ä¸ºèŠ‚ç‚¹å</li>
</ul>
<br>
<p><code>add_conditional_edges</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">add_conditional_edges(</span><br><span class="line">    source: <span class="built_in">str</span>,</span><br><span class="line">    path: <span class="type">Union</span>[</span><br><span class="line">        <span class="type">Callable</span>[..., <span class="type">Union</span>[Hashable, <span class="built_in">list</span>[Hashable]]],</span><br><span class="line">        <span class="type">Callable</span>[</span><br><span class="line">            ..., Awaitable[<span class="type">Union</span>[Hashable, <span class="built_in">list</span>[Hashable]]]</span><br><span class="line">        ],</span><br><span class="line">        Runnable[<span class="type">Any</span>, <span class="type">Union</span>[Hashable, <span class="built_in">list</span>[Hashable]]],</span><br><span class="line">    ],</span><br><span class="line">    path_map: <span class="type">Optional</span>[</span><br><span class="line">        <span class="type">Union</span>[<span class="built_in">dict</span>[Hashable, <span class="built_in">str</span>], <span class="built_in">list</span>[<span class="built_in">str</span>]]</span><br><span class="line">    ] = <span class="literal">None</span>,</span><br><span class="line">    then: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span><br><span class="line">) -&gt; Self</span><br></pre></td></tr></table></figure>
<p>ä»èµ·å§‹èŠ‚ç‚¹æ·»åŠ æ¡ä»¶è¾¹åˆ°ä»»æ„æ•°é‡çš„ç›®æ ‡èŠ‚ç‚¹ã€‚</p>
<p><strong>Parameters: å‚æ•°ï¼š</strong></p>
<ul>
<li><code>source</code> ï¼ˆ <code>str</code> ï¼‰- èµ·å§‹èŠ‚ç‚¹ã€‚å½“é€€å‡ºæ­¤èŠ‚ç‚¹æ—¶ï¼Œå°†è¿è¡Œæ­¤æ¡ä»¶è¾¹ã€‚</li>
<li><code>path</code> ï¼ˆ <code>Union[Callable, Runnable]</code> ï¼‰- ç¡®å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹æˆ–èŠ‚ç‚¹çš„å¯è°ƒç”¨å¯¹è±¡ã€‚å¦‚æœä¸æŒ‡å®š <code>path_map</code> ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ã€‚å¦‚æœè¿”å› ENDï¼Œåˆ™å›¾å½¢å°†åœæ­¢æ‰§è¡Œã€‚</li>
<li><code>path_map</code> ï¼ˆ <code>Optional[dict[Hashable, str]]</code> ï¼Œé»˜è®¤ï¼š <code>None</code> ï¼‰- å¯é€‰çš„è·¯å¾„åˆ°èŠ‚ç‚¹åç§°çš„æ˜ å°„ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ <code>path</code> è¿”å›çš„è·¯å¾„åº”è¯¥æ˜¯èŠ‚ç‚¹åç§°ã€‚</li>
<li><code>then</code> ï¼ˆ <code>Optional[str]</code> ï¼Œé»˜è®¤ï¼š <code>None</code> ï¼‰- åœ¨ <code>path</code> é€‰æ‹©çš„èŠ‚ç‚¹ä¹‹åæ‰§è¡ŒèŠ‚ç‚¹çš„åç§°ã€‚</li>
</ul>
<p><strong>Returns: è¿”å›å€¼ï¼š</strong></p>
<ul>
<li><code>Self</code> ï¼ˆ <code>Self</code> ï¼‰- å›¾çš„å®ä¾‹ï¼Œå…è®¸æ–¹æ³•é“¾å¼è°ƒç”¨ã€‚</li>
</ul>
<br>
<p><code>interrupt</code></p>
<p>LangGraph ä¸­çš„ <code>interrupt</code> å‡½æ•°é€šè¿‡åœ¨ç‰¹å®šèŠ‚ç‚¹æš‚åœå›¾ã€å‘äººç±»å±•ç¤ºä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ä»–ä»¬çš„è¾“å…¥ç»§ç»­å›¾æ¥å¯ç”¨äººç±»åœ¨å¾ªç¯ä¸­çš„å·¥ä½œæµç¨‹ã€‚æ­¤åŠŸèƒ½é€‚ç”¨äºå®¡æ‰¹ã€ç¼–è¾‘æˆ–æ”¶é›†é¢å¤–è¾“å…¥ç­‰ä»»åŠ¡ã€‚ <code>interrupt</code> å‡½æ•°ä¸ <code>Command</code> å¯¹è±¡ä¸€èµ·ä½¿ç”¨ï¼Œä»¥äººç±»æä¾›çš„å€¼ç»§ç»­å›¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">human_approval</span>(<span class="params">state: State</span>) -&gt; Command[<span class="type">Literal</span>[<span class="string">&quot;some_node&quot;</span>, <span class="string">&quot;another_node&quot;</span>]]:</span><br><span class="line">    is_approved = interrupt(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: <span class="string">&quot;Is this correct?&quot;</span>,</span><br><span class="line">            <span class="comment"># Surface the output that should be</span></span><br><span class="line">            <span class="comment"># reviewed and approved by the human.</span></span><br><span class="line">            <span class="string">&quot;llm_output&quot;</span>: state[<span class="string">&quot;llm_output&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> is_approved:</span><br><span class="line">        <span class="keyword">return</span> Command(goto=<span class="string">&quot;some_node&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> Command(goto=<span class="string">&quot;another_node&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the node to the graph in an appropriate location</span></span><br><span class="line"><span class="comment"># and connect it to the relevant nodes.</span></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;human_approval&quot;</span>, human_approval)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=checkpointer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># After running the graph and hitting the interrupt, the graph will pause.</span></span><br><span class="line"><span class="comment"># Resume it with either an approval or rejection.</span></span><br><span class="line">thread_config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;some_id&quot;</span>&#125;&#125;</span><br><span class="line">graph.invoke(Command(resume=<span class="literal">True</span>), config=thread_config)</span><br></pre></td></tr></table></figure>
<br>
<p><strong>æ¡ˆä¾‹ä»£ç </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥å…·ï¼šé€šè¿‡interruptä¸äººç±»äº¤äº’</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="comment"># Note that because we are generating a ToolMessage for a state update, we</span></span><br><span class="line"><span class="comment"># generally require the ID of the corresponding tool call. We can use</span></span><br><span class="line"><span class="comment"># LangChain&#x27;s InjectedToolCallId to signal that this argument should not</span></span><br><span class="line"><span class="comment"># be revealed to the model in the tool&#x27;s schema.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">human_assistance</span>(<span class="params"></span></span><br><span class="line"><span class="params">    name: <span class="built_in">str</span>, birthday: <span class="built_in">str</span>, tool_call_id: Annotated[<span class="built_in">str</span>, InjectedToolCallId]</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Request assistance from a human.&quot;&quot;&quot;</span></span><br><span class="line">    human_response = interrupt(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;question&quot;</span>: <span class="string">&quot;Is this correct?&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">            <span class="string">&quot;birthday&quot;</span>: birthday,</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># If the information is correct, update the state as-is.</span></span><br><span class="line">    <span class="keyword">if</span> human_response.get(<span class="string">&quot;correct&quot;</span>, <span class="string">&quot;&quot;</span>).lower().startswith(<span class="string">&quot;y&quot;</span>):</span><br><span class="line">        verified_name = name</span><br><span class="line">        verified_birthday = birthday</span><br><span class="line">        response = <span class="string">&quot;Correct&quot;</span></span><br><span class="line">    <span class="comment"># Otherwise, receive information from the human reviewer.</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        verified_name = human_response.get(<span class="string">&quot;name&quot;</span>, name)</span><br><span class="line">        verified_birthday = human_response.get(<span class="string">&quot;birthday&quot;</span>, birthday)</span><br><span class="line">        response = <span class="string">f&quot;Made a correction: <span class="subst">&#123;human_response&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># This time we explicitly update the state with a ToolMessage inside</span></span><br><span class="line">    <span class="comment"># the tool.</span></span><br><span class="line">    state_update = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: verified_name,</span><br><span class="line">        <span class="string">&quot;birthday&quot;</span>: verified_birthday,</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [ToolMessage(response, tool_call_id=tool_call_id)],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># We return a Command object in the tool to update our state.</span></span><br><span class="line">    <span class="keyword">return</span> Command(update=state_update)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Modification: tell the LLM which tools it can call</span></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool, human_assistance]</span><br><span class="line"></span><br><span class="line">llm = ChatAnthropic(model=<span class="string">&quot;claude-3-5-sonnet-20240620&quot;</span>)</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    message = llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    <span class="comment"># Because we will be interrupting during tool execution,</span></span><br><span class="line">    <span class="comment"># we disable parallel tool calling to avoid repeating any</span></span><br><span class="line">    <span class="comment"># tool invocations when we resume.</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(message.tool_calls) &lt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_tools</span>(<span class="params"></span></span><br><span class="line"><span class="params">    state: State,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Use in the conditional_edge to route to the ToolNode if the last message</span></span><br><span class="line"><span class="string">    has tool calls. Otherwise, route to the end.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(state, <span class="built_in">list</span>):</span><br><span class="line">        ai_message = state[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> messages := state.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">        ai_message = messages[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;No messages found in input state to tool_edge: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(ai_message, <span class="string">&quot;tool_calls&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(ai_message.tool_calls) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span>  <span class="comment"># path å‡½æ•°è¿”å›çš„ä¸ºèŠ‚ç‚¹åç§°</span></span><br><span class="line">    <span class="keyword">return</span> END  <span class="comment"># path å‡½æ•°è¿”å›çš„ä¸ºèŠ‚ç‚¹åç§°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The `tools_condition` function returns &quot;tools&quot; if the chatbot asks to use a tool, and &quot;END&quot; if</span></span><br><span class="line"><span class="comment"># it is fine directly responding. This conditional routing defines the main agent loop.</span></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    route_tools,</span><br><span class="line">    <span class="comment"># The following dictionary lets you tell the graph to interpret the condition&#x27;s outputs as a specific node</span></span><br><span class="line">    <span class="comment"># It defaults to the identity function, but if you</span></span><br><span class="line">    <span class="comment"># want to use a node named something else apart from &quot;tools&quot;,</span></span><br><span class="line">    <span class="comment"># You can update the value of the dictionary to something else</span></span><br><span class="line">    <span class="comment"># e.g., &quot;tools&quot;: &quot;my_tools&quot;</span></span><br><span class="line">    <span class="comment"># å¯é€‰çš„è·¯å¾„åˆ°èŠ‚ç‚¹åç§°çš„æ˜ å°„ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ `path` è¿”å›çš„è·¯å¾„åº”è¯¥æ˜¯èŠ‚ç‚¹åç§°ã€‚</span></span><br><span class="line">    &#123;<span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, END: END&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line"><span class="comment"># graph = graph_builder.compile()</span></span><br><span class="line">memory = MemorySaver()  <span class="comment"># æ·»åŠ æ£€æŸ¥ç‚¹</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: (</span><br><span class="line">                    <span class="string">&quot;I&#x27;m learning LangGraph. &quot;</span></span><br><span class="line">                    <span class="string">&quot;Could you do some research on it for me?&quot;</span></span><br><span class="line">                ),</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<br>
<br>
<h2 id="Agentic-Design-Patterns">Agentic Design Patterns</h2>
<h3 id="Design-Pattern">Design Pattern</h3>
<img src="/2025/04/21/AI-Agent/5.png" class="" title="alt text">
<ul>
<li>Short-term memory: ä¸Šä¸‹æ–‡Context</li>
<li>Long-term memory: å¤–æŒ‚æ•°æ®åº“ï¼Œä¾‹å¦‚RAGæŠ€æœ¯</li>
<li>Tool: MCP(function callâ€¦)</li>
<li>Planning: Reflectionï¼ŒSelf-criticsâ€¦</li>
</ul>
<br>
<h3 id="Reflection">Reflection</h3>
<ul>
<li>â€œ[Self-Refine: Iterative Refinement with Self-Feedback](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.17651?utm_campaign=The">https://arxiv.org/abs/2303.17651?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9dHVnW1I1bA3sPBbsikjT165Qez3QiiAssknCERwgki818YHG7PyHOQSgg-nxKDa0BuE7B),â€ Madaan et al. (2023)</li>
<li>â€œ[Reflexion: Language Agents with Verbal Reinforcement Learning](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.11366?utm_campaign=The">https://arxiv.org/abs/2303.11366?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9dHVnW1I1bA3sPBbsikjT165Qez3QiiAssknCERwgki818YHG7PyHOQSgg-nxKDa0BuE7B),â€ Shinn et al. (2023)</li>
<li>â€œ[CRITIC: Large Language Models Can Self-Correct with Tool-Interactive Critiquing](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2305.11738?utm_campaign=The">https://arxiv.org/abs/2305.11738?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9dHVnW1I1bA3sPBbsikjT165Qez3QiiAssknCERwgki818YHG7PyHOQSgg-nxKDa0BuE7B),â€ Gou et al. (2024)</li>
</ul>
<br>
<h3 id="Tool-Use">Tool Use</h3>
<ul>
<li>â€œ[Gorilla: Large Language Model Connected with Massive APIs](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2305.15334?utm_campaign=The">https://arxiv.org/abs/2305.15334?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtzâ€“9ARMthd09q0ABUi-abo6BH62BLbcwPo13LrXs9hUezs-L050Ay7b_rHdWuRIqBVOD6k_S),â€ Patil et al. (2023)</li>
<li>â€œ[MM-REACT: Prompting ChatGPT for Multimodal Reasoning and Action](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.11381?utm_campaign=The">https://arxiv.org/abs/2303.11381?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtzâ€“9ARMthd09q0ABUi-abo6BH62BLbcwPo13LrXs9hUezs-L050Ay7b_rHdWuRIqBVOD6k_S),â€ Yang et al. (2023)</li>
<li>â€œ[Efficient Tool Use with Chain-of-Abstraction Reasoning](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2401.17464?utm_campaign=The">https://arxiv.org/abs/2401.17464?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtzâ€“9ARMthd09q0ABUi-abo6BH62BLbcwPo13LrXs9hUezs-L050Ay7b_rHdWuRIqBVOD6k_S),â€ Gao et al. (2024)</li>
</ul>
<br>
<h3 id="Planning">Planning</h3>
<ul>
<li>â€œ[Chain-of-Thought Prompting Elicits Reasoning in Large Language Models](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2201.11903?utm_campaign=The">https://arxiv.org/abs/2201.11903?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8Kh954rkXmE4vgpKvro3Klpjhn7IuT-Y_eXIYtgVIq9PTzwa5zFWX7FZZqv1tuDEEsTDuY),â€ Wei et al. (2022)</li>
<li>â€œ[HuggingGPT: Solving AI Tasks with ChatGPT and its Friends in Hugging Face](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.17580?utm_campaign=The">https://arxiv.org/abs/2303.17580?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8Kh954rkXmE4vgpKvro3Klpjhn7IuT-Y_eXIYtgVIq9PTzwa5zFWX7FZZqv1tuDEEsTDuY),â€ Shen et al. (2023)</li>
<li>â€œ[Understanding the planning of LLM agents: A survey](<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2402.02716.pdf?utm_campaign=The">https://arxiv.org/pdf/2402.02716.pdf?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8Kh954rkXmE4vgpKvro3Klpjhn7IuT-Y_eXIYtgVIq9PTzwa5zFWX7FZZqv1tuDEEsTDuY),â€ by Huang et al. (2024)</li>
</ul>
<br>
<h3 id="Multi-Agent-Collaboration">Multi-Agent Collaboration</h3>
<ul>
<li>â€œ[Communicative Agents for Software Development](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2307.07924?utm_campaign=The">https://arxiv.org/abs/2307.07924?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8TZzur2df1qdnGx09b-Fg94DTsc3-xXao4StKvKNU2HR51el3n8yOm0CPSw6GiAoLQNKua),â€ Qian et al. (2023) (the ChatDev paper)</li>
<li>â€œ[AutoGen: Enabling Next-Gen LLM Applications via Multi-Agent Conversation](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2308.08155?utm_campaign=The">https://arxiv.org/abs/2308.08155?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8TZzur2df1qdnGx09b-Fg94DTsc3-xXao4StKvKNU2HR51el3n8yOm0CPSw6GiAoLQNKua),â€ Wu et al. (2023)</li>
<li>â€œ[MetaGPT: Meta Programming for a Multi-Agent Collaborative Framework](<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2308.00352?utm_campaign=The">https://arxiv.org/abs/2308.00352?utm_campaign=The</a> Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-8TZzur2df1qdnGx09b-Fg94DTsc3-xXao4StKvKNU2HR51el3n8yOm0CPSw6GiAoLQNKua),â€ Hong et al. (2023)</li>
</ul>
<br>
<h2 id="MCP">MCP</h2>
<p>Model Context Protocol</p>
<p>ref: <a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/introduction">https://modelcontextprotocol.io/introduction</a></p>
<p>ref: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/29001189476">https://zhuanlan.zhihu.com/p/29001189476</a></p>
<img src="/2025/04/21/AI-Agent/v2-2bcd98f6541da0b6f14dc9082ee2dcda_1440w.jpg" class="" title="mcp">
<br>
<p><a target="_blank" rel="noopener" href="https://github.com/modelcontextprotocol/python-sdk/tree/main/examples/clients/simple-chatbot/mcp_simple_chatbot">example</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client </span></span><br><span class="line">   ... <span class="comment"># çœç•¥äº†æ— å…³çš„ä»£ç </span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–æ‰€æœ‰çš„ mcp server</span></span><br><span class="line">    <span class="keyword">for</span> server <span class="keyword">in</span> self.servers:</span><br><span class="line">        <span class="keyword">await</span> server.initialize()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–æ‰€æœ‰çš„ tools å‘½åä¸º all_tools</span></span><br><span class="line">    all_tools = []</span><br><span class="line">    <span class="keyword">for</span> server <span class="keyword">in</span> self.servers:</span><br><span class="line">        tools = <span class="keyword">await</span> server.list_tools()</span><br><span class="line">        all_tools.extend(tools)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æ‰€æœ‰çš„ tools çš„åŠŸèƒ½æè¿°æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²ä¾› LLM ä½¿ç”¨</span></span><br><span class="line">    <span class="comment"># tool.format_for_llm() æˆ‘æ”¾åˆ°äº†è¿™æ®µä»£ç æœ€åï¼Œæ–¹ä¾¿é˜…è¯»ã€‚</span></span><br><span class="line">    tools_description = <span class="string">&quot;\n&quot;</span>.join(</span><br><span class="line">        [tool.format_for_llm() <span class="keyword">for</span> tool <span class="keyword">in</span> all_tools]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œå°±ä¸ç®€åŒ–äº†ï¼Œä»¥ä¾›å‚è€ƒï¼Œå®é™…ä¸Šå°±æ˜¯åŸºäº prompt å’Œå½“å‰æ‰€æœ‰å·¥å…·çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># è¯¢é—® LLMï¼ˆClaudeï¼‰ åº”è¯¥ä½¿ç”¨å“ªäº›å·¥å…·ã€‚</span></span><br><span class="line">    system_message = (</span><br><span class="line">        <span class="string">&quot;You are a helpful assistant with access to these tools:\n\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;tools_description&#125;</span>\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Choose the appropriate tool based on the user&#x27;s question. &quot;</span></span><br><span class="line">        <span class="string">&quot;If no tool is needed, reply directly.\n\n&quot;</span></span><br><span class="line">        <span class="string">&quot;IMPORTANT: When you need to use a tool, you must ONLY respond with &quot;</span></span><br><span class="line">        <span class="string">&quot;the exact JSON object format below, nothing else:\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">        <span class="string">&#x27;    &quot;tool&quot;: &quot;tool-name&quot;,\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;    &quot;arguments&quot;: &#123;\n&#x27;</span></span><br><span class="line">        <span class="string">&#x27;        &quot;argument-name&quot;: &quot;value&quot;\n&#x27;</span></span><br><span class="line">        <span class="string">&quot;    &#125;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;&#125;\n\n&quot;</span></span><br><span class="line">        <span class="string">&quot;After receiving a tool&#x27;s response:\n&quot;</span></span><br><span class="line">        <span class="string">&quot;1. Transform the raw data into a natural, conversational response\n&quot;</span></span><br><span class="line">        <span class="string">&quot;2. Keep responses concise but informative\n&quot;</span></span><br><span class="line">        <span class="string">&quot;3. Focus on the most relevant information\n&quot;</span></span><br><span class="line">        <span class="string">&quot;4. Use appropriate context from the user&#x27;s question\n&quot;</span></span><br><span class="line">        <span class="string">&quot;5. Avoid simply repeating the raw data\n\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Please use only the tools that are explicitly defined above.&quot;</span></span><br><span class="line">    )</span><br><span class="line">    messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_message&#125;]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># Final... å‡è®¾è¿™é‡Œå·²ç»å¤„ç†äº†ç”¨æˆ·æ¶ˆæ¯è¾“å…¥.</span></span><br><span class="line">        messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_input&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°† system_message å’Œç”¨æˆ·æ¶ˆæ¯è¾“å…¥ä¸€èµ·å‘é€ç»™ LLM</span></span><br><span class="line">        llm_response = self.llm_client.get_response(messages)</span><br><span class="line"></span><br><span class="line">    ... <span class="comment"># åé¢å’Œç¡®å®šä½¿ç”¨å“ªäº›å·¥å…·æ— å…³</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># server</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Represents a tool with its properties and formatting.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, name: <span class="built_in">str</span>, description: <span class="built_in">str</span>, input_schema: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.name: <span class="built_in">str</span> = name</span><br><span class="line">        self.description: <span class="built_in">str</span> = description</span><br><span class="line">        self.input_schema: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = input_schema</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŠŠå·¥å…·çš„åå­— / å·¥å…·çš„ç”¨é€”ï¼ˆdescriptionï¼‰å’Œå·¥å…·æ‰€éœ€è¦çš„å‚æ•°ï¼ˆargs_descï¼‰è½¬åŒ–ä¸ºæ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">format_for_llm</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Format tool information for LLM.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            A formatted string describing the tool.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        args_desc = []</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;properties&quot;</span> <span class="keyword">in</span> self.input_schema:</span><br><span class="line">            <span class="keyword">for</span> param_name, param_info <span class="keyword">in</span> self.input_schema[<span class="string">&quot;properties&quot;</span>].items():</span><br><span class="line">                arg_desc = (</span><br><span class="line">                    <span class="string">f&quot;- <span class="subst">&#123;param_name&#125;</span>: <span class="subst">&#123;param_info.get(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;No description&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">if</span> param_name <span class="keyword">in</span> self.input_schema.get(<span class="string">&quot;required&quot;</span>, []):</span><br><span class="line">                    arg_desc += <span class="string">&quot; (required)&quot;</span></span><br><span class="line">                args_desc.append(arg_desc)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Tool: <span class="subst">&#123;self.name&#125;</span></span></span><br><span class="line"><span class="string">Description: <span class="subst">&#123;self.description&#125;</span></span></span><br><span class="line"><span class="string">Arguments:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;<span class="built_in">chr</span>(<span class="number">10</span>).join(args_desc)&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<br>
<h2 id="å¾®è°ƒæ•°æ®é›†æ„å»º">å¾®è°ƒæ•°æ®é›†æ„å»º</h2>
<h3 id="Chunking-2">Chunking</h3>
<p>åˆ†å—æ–¹æ¡ˆå‚è€ƒä¸Šæ–‡</p>
<h3 id="é—®é¢˜åˆ›å»º-é—®é¢˜æ±‚è§£">é—®é¢˜åˆ›å»º&amp;é—®é¢˜æ±‚è§£</h3>
<p>é’ˆå¯¹äºåˆ†å‰²å¥½çš„æ–‡æœ¬å—ï¼Œé€šè¿‡LLMä¸ºå…¶ç”Ÿæˆå¯¹åº”é—®é¢˜</p>
<br>
<h2 id="KBQA">KBQA</h2>
<p>Knowledge Based Question Answering (KBQA) aims to answer factual questions based on the provided knowledge base (KB).</p>
<p>ref: <a target="_blank" rel="noopener" href="https://github.com/RUCAIBox/Awesome-KBQA">https://github.com/RUCAIBox/Awesome-KBQA</a></p>
<br>
<h3 id="Semantic-Parsing-based-Methods">Semantic Parsing-based Methods</h3>
<br>
<h3 id="Information-retrieval-based-Methods">Information retrieval-based Methods</h3>
<br>
<h3 id="Other-Methods">Other Methods</h3>
<br>
<h2 id="RAG">RAG</h2>
<p>æŠ€æœ¯å…¥é—¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/fareedkhan-dev/all-rag-techniques">https://github.com/fareedkhan-dev/all-rag-techniques</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/NirDiamant/RAG_Techniques">https://github.com/NirDiamant/RAG_Techniques</a></p>
<h3 id="RAG-Design">RAG Design</h3>
<p>ref: <a target="_blank" rel="noopener" href="https://abdullin.com/ilya/how-to-build-best-rag/">https://abdullin.com/ilya/how-to-build-best-rag/</a></p>
<h3 id="Effective-Chunking-Strategies-for-RAG">Effective Chunking Strategies for RAG</h3>
<p><a target="_blank" rel="noopener" href="https://docs.cohere.com/page/chunking-strategies">https://docs.cohere.com/page/chunking-strategies</a></p>
<h3 id="Embedding">Embedding</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/FlagOpen/FlagEmbedding">https://github.com/FlagOpen/FlagEmbedding</a></p>
<h3 id="Reranker">Reranker</h3>
<p><a target="_blank" rel="noopener" href="https://www.pinecone.io/learn/series/rag/rerankers/">https://www.pinecone.io/learn/series/rag/rerankers/</a></p>
<p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥å®Œæˆè¿™ä¸‰é¡¹å…³äº RAG (Retrieval-Augmented Generation) æ‰©å±•æ–¹æ³•çš„è¯¦ç»†è¯´æ˜ã€‚</p>
<hr>
<h3 id="Extended-Method">Extended Method</h3>
<h4 id="å‡è®¾æ€§æ–‡æ¡£åµŒå…¥-Hypothetical-Document-Embedding-HDE">å‡è®¾æ€§æ–‡æ¡£åµŒå…¥ (Hypothetical Document Embedding - HDE)</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong><br>
ä¸å…¶ç›´æ¥å¯¹ç”¨æˆ·çš„ç®€çŸ­ã€æ¨¡ç³Šçš„æŸ¥è¯¢ï¼ˆQueryï¼‰è¿›è¡ŒåµŒå…¥ï¼Œä¸å¦‚å…ˆè®©ä¸€ä¸ªå¤§å‹è¯­è¨€æ¨¡å‹ (LLM) æ ¹æ®è¯¥æŸ¥è¯¢ç”Ÿæˆä¸€ä¸ªå®ƒè®¤ä¸ºæœ€ç†æƒ³ã€æœ€å®Œæ•´çš„â€œå‡è®¾æ€§ç­”æ¡ˆâ€æˆ–â€œå‡è®¾æ€§æ–‡æ¡£â€ï¼Œç„¶åå¯¹è¿™ä¸ªå†…å®¹æ›´ä¸°å¯Œã€è¯­ä¹‰æ›´æ˜ç¡®çš„å‡è®¾æ€§æ–‡æ¡£è¿›è¡ŒåµŒå…¥ï¼Œå†ç”¨å…¶ç”Ÿæˆçš„å‘é‡å»çŸ¥è¯†åº“ä¸­è¿›è¡Œå‘é‡æ£€ç´¢ã€‚</p>
<p><strong>è§£å†³çš„é—®é¢˜ï¼š</strong><br>
å®ƒä¸»è¦è§£å†³â€œ<strong>æŸ¥è¯¢ä¸æ–‡æ¡£ä¹‹é—´çš„è¯­ä¹‰é¸¿æ²Ÿ (Semantic Gap)</strong>â€é—®é¢˜ã€‚ç”¨æˆ·çš„æŸ¥è¯¢é€šå¸¸å¾ˆçŸ­ï¼ˆå¦‚â€œä»€ä¹ˆæ˜¯å…‰åˆä½œç”¨ï¼Ÿâ€ï¼‰ï¼Œè€ŒçŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£é€šå¸¸å¾ˆé•¿ï¼ŒåŒ…å«è¯¦ç»†çš„è§£é‡Šã€èƒŒæ™¯å’Œä¾‹å­ã€‚è¿™ä¸¤ç§ä¸åŒå½¢å¼çš„æ–‡æœ¬åœ¨åµŒå…¥ç©ºé—´ä¸­çš„å‘é‡å¯èƒ½ç›¸è·ç”šè¿œï¼Œå¯¼è‡´æ£€ç´¢æ•ˆæœä¸ä½³ã€‚HDEé€šè¿‡ç”Ÿæˆä¸€ä¸ªä¸ç›®æ ‡æ–‡æ¡£åœ¨æ ¼å¼ã€é•¿åº¦å’Œå†…å®¹ä¸Šéƒ½æ›´ç›¸ä¼¼çš„â€œä¸­é—´æ–‡æ¡£â€ï¼Œæå¤§åœ°ç¼©å°äº†è¿™ä¸€é¸¿æ²Ÿã€‚</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<ol>
<li>
<p><strong>æ¥æ”¶æŸ¥è¯¢ (Receive Query):</strong> ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šâ€œå¦‚ä½•ä¸ºæˆ‘çš„åˆåˆ›å…¬å¸è¿›è¡Œç§å­è½®èèµ„ï¼Ÿâ€</p>
</li>
<li>
<p><strong>ç”Ÿæˆå‡è®¾æ€§æ–‡æ¡£ (Generate Hypothetical Document):</strong> ç³»ç»Ÿå°†è¯¥æŸ¥è¯¢å‘é€ç»™ä¸€ä¸ª LLMï¼Œå¹¶æç¤ºå®ƒï¼šâ€œè¯·ç”Ÿæˆä¸€ä»½è¯¦ç»†å›ç­”â€˜å¦‚ä½•ä¸ºæˆ‘çš„åˆåˆ›å…¬å¸è¿›è¡Œç§å­è½®èèµ„ï¼Ÿâ€™è¿™ä¸ªé—®é¢˜çš„æ–‡æ¡£ã€‚â€</p>
</li>
<li>
<p><strong>LLM è¾“å‡º:</strong> LLM å¯èƒ½ä¼šç”Ÿæˆå¦‚ä¸‹çš„å‡è®¾æ€§æ–‡æ¡£ï¼š</p>
<blockquote>
<p>â€œä¸ºåˆåˆ›å…¬å¸è¿›è¡Œç§å­è½®èèµ„é€šå¸¸æ¶‰åŠå‡ ä¸ªå…³é”®æ­¥éª¤ã€‚é¦–å…ˆï¼Œä½ éœ€è¦ä¸€ä¸ªæ¸…æ™°çš„å•†ä¸šè®¡åˆ’ä¹¦ã€ä¸€ä¸ªæœ€å°å¯è¡Œäº§å“ï¼ˆMVPï¼‰å’Œä¸€ä¸ªæœ‰è¯´æœåŠ›çš„æ¼”è®²ç¨¿ã€‚å…¶æ¬¡ï¼Œå»ºç«‹ä½ çš„æŠ•èµ„äººç½‘ç»œè‡³å…³é‡è¦ï¼Œå¯ä»¥ä»å¤©ä½¿æŠ•èµ„äººå’Œæ—©æœŸé£é™©æŠ•èµ„æœºæ„å¼€å§‹ã€‚åœ¨æ¥è§¦æŠ•èµ„äººæ—¶ï¼Œè¦æ¸…æ™°åœ°é˜è¿°ä½ çš„å¸‚åœºæœºä¼šã€å›¢é˜Ÿä¼˜åŠ¿å’Œè´¢åŠ¡é¢„æµ‹â€¦â€</p>
</blockquote>
</li>
<li>
<p><strong>åµŒå…¥å‡è®¾æ€§æ–‡æ¡£ (Embed Hypothetical Document):</strong> ç³»ç»Ÿå°†è¿™ä¸ªç”± LLM ç”Ÿæˆçš„ã€å†…å®¹ä¸°å¯Œçš„å‡è®¾æ€§æ–‡æ¡£é€šè¿‡åµŒå…¥æ¨¡å‹ï¼ˆEmbedding Modelï¼‰è½¬æ¢æˆä¸€ä¸ªå‘é‡ã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡Œæ£€ç´¢ (Perform Retrieval):</strong> ä½¿ç”¨è¿™ä¸ªæ–°ç”Ÿæˆçš„å‘é‡ï¼Œåœ¨æ–‡æ¡£/çŸ¥è¯†åº“çš„å‘é‡ç´¢å¼•ä¸­è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œæ‰¾å‡ºä¸è¿™ä¸ªâ€œç†æƒ³ç­”æ¡ˆâ€æœ€åŒ¹é…çš„å®é™…æ–‡æ¡£ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ (Generate Final Answer):</strong> å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£å’ŒåŸå§‹æŸ¥è¯¢ä¸€èµ·æä¾›ç»™ LLMï¼Œç”Ÿæˆæœ€ç»ˆçš„ã€æœ‰äº‹å®ä¾æ®çš„ç­”æ¡ˆã€‚</p>
</li>
</ol>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æé«˜æ£€ç´¢ç²¾åº¦ï¼š</strong> æ˜¾è‘—æ”¹å–„äº†æŸ¥è¯¢å’Œæ–‡æ¡£ä¹‹é—´çš„è¯­ä¹‰åŒ¹é…åº¦ï¼Œèƒ½æ‰¾åˆ°æ›´ç›¸å…³çš„å†…å®¹ã€‚</li>
<li><strong>å¤„ç†æ¨¡ç³ŠæŸ¥è¯¢ï¼š</strong> å¯¹äºæ„å›¾ä¸æ˜ç¡®æˆ–è¿‡äºç®€çŸ­çš„æŸ¥è¯¢ï¼Œæ•ˆæœæå‡å°¤ä¸ºæ˜æ˜¾ã€‚</li>
</ul>
<p><strong>æŒ‘æˆ˜ä¸è€ƒé‡ï¼š</strong></p>
<ul>
<li><strong>å¢åŠ å»¶è¿Ÿï¼š</strong> åœ¨æ£€ç´¢å‰å¢åŠ äº†ä¸€æ¬¡ LLM è°ƒç”¨ï¼Œå¯¼è‡´æ•´ä½“å“åº”æ—¶é—´å˜é•¿ã€‚</li>
<li><strong>å¢åŠ æˆæœ¬ï¼š</strong> é¢å¤–çš„ LLM è°ƒç”¨ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ã€‚</li>
<li><strong>ä¾èµ–ç”Ÿæˆè´¨é‡ï¼š</strong> å‡è®¾æ€§æ–‡æ¡£çš„è´¨é‡ç›´æ¥å†³å®šäº†æ£€ç´¢æ•ˆæœçš„å¥½åã€‚</li>
</ul>
<hr>
<h4 id="è¿­ä»£å¼æ£€ç´¢ç”Ÿæˆ-Iterative-Retrieval-Generation-IRG">è¿­ä»£å¼æ£€ç´¢ç”Ÿæˆ (Iterative Retrieval Generation - IRG)</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong><br>
å°†æ£€ç´¢å’Œç”Ÿæˆè¿‡ç¨‹ä»â€œä¸€æ¬¡æ€§å®Œæˆâ€çš„çº¿æ€§æµç¨‹ï¼Œè½¬å˜ä¸ºä¸€ä¸ªå¾ªç¯ã€è¿­ä»£ã€é€æ­¥æ±‚ç²¾çš„è¿‡ç¨‹ã€‚ç³»ç»Ÿä¼šæ ¹æ®åˆæ­¥ç”Ÿæˆçš„ç­”æ¡ˆæˆ–ä¸­é—´æ€è€ƒï¼Œä¸»åŠ¨å‘ç°çŸ¥è¯†ç¼ºå£ï¼Œå¹¶ç”Ÿæˆæ–°çš„æŸ¥è¯¢ä»¥è·å–æ›´å¤šä¿¡æ¯ï¼Œç›´åˆ°èƒ½å¤Ÿå½¢æˆä¸€ä¸ªå®Œæ•´ã€å‡†ç¡®çš„ç­”æ¡ˆä¸ºæ­¢ã€‚</p>
<p><strong>è§£å†³çš„é—®é¢˜ï¼š</strong><br>
å®ƒä¸»è¦è§£å†³<strong>å¤æ‚ã€å¤šæ­¥éª¤æˆ–éœ€è¦æ•´åˆå¤šæ–¹é¢çŸ¥è¯†çš„æŸ¥è¯¢ (Complex, Multi-hop Questions)</strong>ã€‚å¯¹äºè¿™ç±»é—®é¢˜ï¼Œå•æ¬¡æ£€ç´¢å¾€å¾€æ— æ³•è·å–æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œâ€œæ¯”è¾ƒä¸€ä¸‹ã€ŠæŒ‡ç¯ç‹ã€‹å’Œã€Šå†°ä¸ç«ä¹‹æ­Œã€‹åœ¨ä¸–ç•Œæ„å»ºå’Œè§’è‰²å¡‘é€ ä¸Šçš„å¼‚åŒï¼Ÿâ€</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<ol>
<li><strong>åˆå§‹æ£€ç´¢ (Initial Retrieval):</strong> ç³»ç»Ÿæ¥æ”¶åˆå§‹æŸ¥è¯¢ï¼Œå¹¶è¿›è¡Œç¬¬ä¸€æ¬¡æ£€ç´¢ï¼Œè·å–ä¸€æ‰¹ç›¸å…³æ–‡æ¡£ã€‚</li>
<li><strong>åˆæ­¥ç”Ÿæˆä¸åˆ†æ (Initial Generation &amp; Analysis):</strong> LLM åŸºäºç¬¬ä¸€æ¬¡æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼Œå°è¯•ç”Ÿæˆç­”æ¡ˆã€‚åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šè¯†åˆ«å‡ºå½“å‰ä¿¡æ¯ä¸­çš„ä¸è¶³ä¹‹å¤„ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½æ‰¾åˆ°äº†å…³äºã€ŠæŒ‡ç¯ç‹ã€‹ä¸–ç•Œæ„å»ºçš„èµ„æ–™ï¼Œä½†ç¼ºå°‘ã€Šå†°ä¸ç«ä¹‹æ­Œã€‹è§’è‰²å¡‘é€ çš„ç»†èŠ‚ã€‚</li>
<li><strong>ç”Ÿæˆæ–°æŸ¥è¯¢ (Generate New Queries):</strong> åŸºäºè¯†åˆ«å‡ºçš„çŸ¥è¯†ç¼ºå£ï¼Œç³»ç»Ÿï¼ˆæˆ– LLM æœ¬èº«ï¼‰ä¼šç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªæ–°çš„ã€æ›´å…·é’ˆå¯¹æ€§çš„æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼šâ€œã€Šå†°ä¸ç«ä¹‹æ­Œã€‹ä¸­çš„ä¸»è¦è§’è‰²å¡‘é€ æŠ€å·§â€ã€â€œã€ŠæŒ‡ç¯ç‹ã€‹çš„é­”æ³•ç³»ç»Ÿè®¾å®šâ€ã€‚</li>
<li><strong>è¿­ä»£æ£€ç´¢ (Iterative Retrieval):</strong> ç³»ç»Ÿä½¿ç”¨è¿™äº›æ–°æŸ¥è¯¢å»çŸ¥è¯†åº“ä¸­è¿›è¡Œæ–°ä¸€è½®çš„æ£€ç´¢ï¼Œè·å–è¡¥å……ä¿¡æ¯ã€‚</li>
<li><strong>æ•´åˆä¸ç²¾ç‚¼ (Integration &amp; Refinement):</strong> å°†æ‰€æœ‰è½®æ¬¡æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œæ•´åˆï¼Œå¹¶äº¤ç”± LLM è¿›è¡Œæœ€ç»ˆçš„ç»¼åˆæ€§å›ç­”ã€‚</li>
<li><strong>å¾ªç¯ç»ˆæ­¢ï¼š</strong> å½“ LLM åˆ¤æ–­ä¿¡æ¯å·²ç»è¶³å¤Ÿå…¨é¢ï¼Œæˆ–è€…è¾¾åˆ°é¢„è®¾çš„è¿­ä»£æ¬¡æ•°æ—¶ï¼Œå¾ªç¯ç»“æŸã€‚</li>
</ol>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¤„ç†å¤æ‚é—®é¢˜ï¼š</strong> èƒ½å¤Ÿåƒäººç±»ç ”ç©¶å‘˜ä¸€æ ·ï¼Œé€æ­¥æ·±å…¥ï¼Œè§£å†³éœ€è¦å¤šæ–¹é¢ä¿¡æ¯æ”¯æŒçš„å¤æ‚é—®é¢˜ã€‚</li>
<li><strong>æé«˜ç­”æ¡ˆçš„å…¨é¢æ€§å’Œæ·±åº¦ï¼š</strong> é€šè¿‡è¡¥å……æ£€ç´¢ï¼Œç¡®ä¿ç­”æ¡ˆè¦†ç›–äº†é—®é¢˜çš„æ‰€æœ‰æ–¹é¢ã€‚</li>
</ul>
<p><strong>æŒ‘æˆ˜ä¸è€ƒé‡ï¼š</strong></p>
<ul>
<li><strong>é«˜å»¶è¿Ÿå’Œé«˜æˆæœ¬ï¼š</strong> å¤šæ¬¡æ£€ç´¢å’Œç”Ÿæˆæ­¥éª¤æ˜¾è‘—å¢åŠ äº†å“åº”æ—¶é—´å’Œè®¡ç®—æˆæœ¬ã€‚</li>
<li><strong>é€»è¾‘å¤æ‚æ€§ï¼š</strong> å®ç°ä¸€ä¸ªæœ‰æ•ˆçš„è¿­ä»£å¾ªç¯ã€åˆ¤æ–­ä½•æ—¶åœæ­¢ä»¥åŠå¦‚ä½•ç”Ÿæˆæœ‰æ•ˆçš„åç»­æŸ¥è¯¢ï¼ŒæŠ€æœ¯ä¸Šæ›´å…·æŒ‘æˆ˜æ€§ã€‚</li>
<li><strong>å¯èƒ½é™·å…¥æ— æ•ˆå¾ªç¯ï¼š</strong> å¦‚æœåç»­æŸ¥è¯¢ç”Ÿæˆå¾—ä¸å¥½ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ£€ç´¢ä¸åˆ°æœ‰ç”¨ä¿¡æ¯ï¼Œé™·å…¥ä½æ•ˆå¾ªç¯ã€‚</li>
</ul>
<hr>
<h4 id="ä¼˜åŒ–ç¨ å¯†åŠ ç¨€ç–æ£€ç´¢-Optimized-Dense-Sparse-Retrieval">ä¼˜åŒ–ç¨ å¯†åŠ ç¨€ç–æ£€ç´¢ (Optimized Dense + Sparse Retrieval)</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong><br>
è¿™æ˜¯ä¸€ç§æ··åˆæ£€ç´¢ï¼ˆHybrid Retrievalï¼‰ç­–ç•¥ï¼Œå®ƒç»“åˆäº†ä¸¤ç§ä¸»æµæ£€ç´¢æŠ€æœ¯çš„ä¼˜ç‚¹ï¼š<strong>ç¨ å¯†æ£€ç´¢ (Dense Retrieval)</strong> å’Œ <strong>ç¨€ç–æ£€ç´¢ (Sparse Retrieval)</strong>ï¼Œä»¥å®ç°æ¯”å•ä¸€æŠ€æœ¯æ›´å¼ºå¤§ã€æ›´é²æ£’çš„æ£€ç´¢æ•ˆæœã€‚</p>
<ul>
<li>
<p><strong>ç¨ å¯†æ£€ç´¢ (Dense Retrieval):</strong></p>
<ul>
<li><strong>æŠ€æœ¯:</strong> åŸºäºå‘é‡åµŒå…¥ï¼ˆEmbeddingsï¼‰å’Œå‘é‡ç›¸ä¼¼æ€§æœç´¢ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ã€‚</li>
<li><strong>ä¼˜ç‚¹:</strong> æ“…é•¿ç†è§£<strong>è¯­ä¹‰å’Œä¸Šä¸‹æ–‡</strong>ã€‚èƒ½å¤ŸåŒ¹é…æ„æ€ç›¸è¿‘ä½†ç”¨è¯ä¸åŒçš„æŸ¥è¯¢å’Œæ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼ŒæŸ¥è¯¢â€œç¾å›½æ€»ç»Ÿå®˜é‚¸â€èƒ½åŒ¹é…åˆ°åŒ…å«â€œç™½å®«â€çš„æ–‡æ¡£ï¼‰ã€‚</li>
<li><strong>ç¼ºç‚¹:</strong> å¯¹äº<strong>å…³é”®è¯ã€ä¸“ä¸šæœ¯è¯­ã€ID æˆ–ç¼©å†™</strong>çš„ç²¾ç¡®åŒ¹é…èƒ½åŠ›è¾ƒå¼±ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¨€ç–æ£€ç´¢ (Sparse Retrieval):</strong></p>
<ul>
<li><strong>æŠ€æœ¯:</strong> åŸºäºå…³é”®è¯é¢‘ç‡å’Œåˆ†å¸ƒçš„ä¼ ç»Ÿä¿¡æ¯æ£€ç´¢æ–¹æ³•ï¼ˆå¦‚ BM25ã€TF-IDFï¼‰ã€‚</li>
<li><strong>ä¼˜ç‚¹:</strong> æ“…é•¿<strong>ç²¾ç¡®åŒ¹é…å…³é”®è¯</strong>ã€‚å¯¹äºåŒ…å«ç‰¹å®šæœ¯è¯­ã€äº§å“å‹å·ï¼ˆå¦‚â€œiPhone 15 Proâ€ï¼‰æˆ–ä»£ç æ ‡è¯†ç¬¦çš„æŸ¥è¯¢ï¼Œæ•ˆæœæä½³ã€‚è®¡ç®—é€Ÿåº¦å¿«ï¼Œèµ„æºæ¶ˆè€—ä½ã€‚</li>
<li><strong>ç¼ºç‚¹:</strong> æ— æ³•ç†è§£è¯­ä¹‰ã€‚æ— æ³•åŒ¹é…åŒä¹‰è¯æˆ–è¿‘ä¹‰è¯ï¼ˆæŸ¥è¯¢â€œæ±½è½¦â€æ— æ³•åŒ¹é…åˆ°åŒ…å«â€œautomobileâ€çš„æ–‡æ¡£ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å·¥ä½œåŸç† (ä¼˜åŒ–ç»“åˆ):</strong></p>
<ol>
<li><strong>å¹¶è¡Œæ£€ç´¢ (Parallel Retrieval):</strong> å½“ç”¨æˆ·è¾“å…¥æŸ¥è¯¢æ—¶ï¼Œç³»ç»Ÿä¼š<strong>åŒæ—¶</strong>ä½¿ç”¨ä¸¤ç§æ–¹æ³•è¿›è¡Œæ£€ç´¢ï¼š
<ul>
<li><strong>ç¨ å¯†è·¯å¾„ï¼š</strong> å°†æŸ¥è¯¢åµŒå…¥ä¸ºå‘é‡ï¼Œåœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„æ–‡æ¡£ã€‚</li>
<li><strong>ç¨€ç–è·¯å¾„ï¼š</strong> å¯¹æŸ¥è¯¢è¿›è¡Œåˆ†è¯ï¼Œåœ¨å€’æ’ç´¢å¼•ï¼ˆå¦‚ Elasticsearchï¼‰ä¸­ä½¿ç”¨ BM25 ç®—æ³•æœç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ã€‚</li>
</ul>
</li>
<li><strong>ç»“æœèåˆ (Result Fusion):</strong> ç³»ç»Ÿä¼šå¾—åˆ°ä¸¤ä¸ªç‹¬ç«‹çš„ã€æŒ‰ç›¸å…³æ€§æ’åºçš„æ–‡æ¡£åˆ—è¡¨ã€‚ä¸‹ä¸€æ­¥æ˜¯æ™ºèƒ½åœ°å°†è¿™ä¸¤ä¸ªåˆ—è¡¨èåˆæˆä¸€ä¸ªæœ€ç»ˆåˆ—è¡¨ã€‚æœ€å¸¸ç”¨çš„èåˆç®—æ³•æ˜¯ <strong>â€œå€’æ•°æ’åºèåˆâ€ (Reciprocal Rank Fusion - RRF)</strong>ã€‚
<ul>
<li><strong>RRF ç®—æ³•ï¼š</strong> è¯¥ç®—æ³•ä¸å…³å¿ƒæ¯ä¸ªæ£€ç´¢ç³»ç»Ÿçš„åŸå§‹åˆ†æ•°ï¼ˆå› ä¸ºå®ƒä»¬çš„é‡çº²ä¸åŒï¼‰ï¼Œåªå…³å¿ƒæ–‡æ¡£åœ¨å„è‡ªåˆ—è¡¨ä¸­çš„<strong>æ’å (Rank)</strong>ã€‚ä¸€ä¸ªæ–‡æ¡£çš„æœ€ç»ˆåˆ†æ•°æ˜¯å®ƒåœ¨æ¯ä¸ªåˆ—è¡¨ä¸­æ’åçš„å€’æ•°ä¹‹å’Œã€‚æ’åè¶Šé å‰ï¼Œå€’æ•°è¶Šå¤§ï¼Œæœ€ç»ˆåˆ†æ•°ä¹Ÿè¶Šé«˜ã€‚</li>
<li><strong>å…¬å¼:</strong> <code>RRF_Score(doc) = Î£ (1 / (k + rank_i(doc)))</code>ï¼Œå…¶ä¸­ <code>rank_i(doc)</code> æ˜¯æ–‡æ¡£åœ¨ç¬¬ <code>i</code> ä¸ªæ£€ç´¢ç»“æœåˆ—è¡¨ä¸­çš„æ’åï¼Œ<code>k</code> æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ˆé€šå¸¸è®¾ä¸º60ï¼‰ï¼Œç”¨äºé™ä½ä½æ’åæ–‡æ¡£çš„å½±å“ã€‚</li>
</ul>
</li>
<li><strong>æœ€ç»ˆæ’åºä¸æˆªæ–­ (Final Ranking &amp; Truncation):</strong> æ ¹æ® RRF åˆ†æ•°å¯¹æ‰€æœ‰æ–‡æ¡£è¿›è¡Œé‡æ–°æ’åºï¼Œå¹¶é€‰å–æ’åæœ€é«˜çš„ Top-K ä¸ªæ–‡æ¡£ï¼Œç”¨äºåç»­çš„ç”Ÿæˆç¯èŠ‚ã€‚</li>
</ol>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å–é•¿è¡¥çŸ­ï¼š</strong> ç»“åˆäº†è¯­ä¹‰ç†è§£å’Œå…³é”®è¯åŒ¹é…çš„èƒ½åŠ›ï¼Œæ˜¯ç›®å‰æœ€æœ‰æ•ˆçš„é€šç”¨æ£€ç´¢ç­–ç•¥ä¹‹ä¸€ã€‚</li>
<li><strong>é²æ£’æ€§å¼ºï¼š</strong> å³ä½¿ä¸€ç§æ£€ç´¢æ–¹æ³•æ•ˆæœä¸ä½³ï¼Œå¦ä¸€ç§æ–¹æ³•ä»å¯èƒ½å¬å›ç›¸å…³çš„æ–‡æ¡£ï¼Œå¤§å¤§é™ä½äº†æ£€ç´¢å¤±è´¥çš„é£é™©ã€‚</li>
<li><strong>æ˜¾è‘—æå‡ç›¸å…³æ€§ï¼š</strong> åœ¨å¤šæ•°åœºæ™¯ä¸‹ï¼Œæ··åˆæ£€ç´¢å¬å›çš„æ–‡æ¡£è´¨é‡è¿œé«˜äºä»»ä½•å•ä¸€æ£€ç´¢æ–¹æ³•ã€‚</li>
</ul>
<p><strong>æŒ‘æˆ˜ä¸è€ƒé‡ï¼š</strong></p>
<ul>
<li><strong>ç³»ç»Ÿå¤æ‚æ€§ï¼š</strong> éœ€è¦åŒæ—¶ç»´æŠ¤å‘é‡æ•°æ®åº“å’Œå…³é”®è¯ç´¢å¼•ä¸¤ç§åŸºç¡€è®¾æ–½ã€‚</li>
<li><strong>è°ƒä¼˜æŒ‘æˆ˜ï¼š</strong> èåˆç­–ç•¥ï¼ˆå¦‚ RRFä¸­çš„ <code>k</code> å€¼ï¼‰æˆ–ä¸åŒæ£€ç´¢ç»“æœçš„æƒé‡éœ€è¦è¿›è¡Œå®éªŒå’Œè°ƒä¼˜ï¼Œä»¥è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚</li>
</ul>
<h3 id="Improved-RAG">Improved RAG</h3>
<h4 id="GraphRAG">GraphRAG</h4>
<p><a target="_blank" rel="noopener" href="https://microsoft.github.io/graphrag/">https://microsoft.github.io/graphrag/</a></p>
<ol>
<li>
<p>Source Documents â†’ Text Chunks</p>
<p>To start, the documents in the corpus are split into text chunks. The LLM extracts information from each chunk for downstream processing.</p>
</li>
<li>
<p>Text Chunks â†’ Entities &amp; Relationships</p>
<p>the LLM is promptedï¼ˆthrought few-shot promptï¼‰ to extract instances of important entities and the relationships between the entities from a given chunk. Additionally, the LLM generates short descriptions for the entities and relationships</p>
<img src="/2025/04/21/AI-Agent/image-20250604165407470.png" class="" title="image-20250604165407470">
<p>The LLM can also be prompted to extract claims about detected entities. Claims are important factual statements about entities, such as dates, events, and interactions with other entities. As with entities and relationships, in-context learning exemplars can provide domain-specific guidance.</p>
<img src="/2025/04/21/AI-Agent/image-20250604170724823.png" class="" title="image-20250604170724823">
</li>
<li>
<p>Entities &amp; Relationships â†’ Knowledge Graph</p>
<p>In the final step of the knowledge graph extraction process, these instances of entities and relationships become individual nodes and edges in the graph. Entity descriptions are aggregated and summarized for each node and edge. Relationships are aggregated into graph edges, where the number of duplicates for a given relationship becomes edge weights. Claims are aggregated similarly</p>
</li>
<li>
<p>Knowledge Graph â†’ Graph Communities</p>
<p>we use Leiden community detection (Traag et al., 2019) in a hierarchical manner, recursively detecting sub-communities within each detected community until reaching leaf communities that can no longer be partitioned. Each level of this hierarchy provides a community partition that covers the nodes of the graph in a mutually exclusive, collectively exhaustive way, enabling divide-and-conquer global summarization.</p>
</li>
<li>
<p>Graph Communities â†’ Community Summaries</p>
<img src="/2025/04/21/AI-Agent/image-20250604173158175.png" class="" title="image-20250604173158175">
</li>
<li>
<p>Community Summaries â†’ Community Answers â†’ Global Answer</p>
<img src="/2025/04/21/AI-Agent/image-20250604173209083.png" class="" title="image-20250604173209083">
</li>
</ol>
<h4 id="LightRAG">LightRAG</h4>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2410.05779">arxiv.org/abs/2410.05779</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/HKUDS/LightRAG">https://github.com/HKUDS/LightRAG</a></p>
<img src="/2025/04/21/AI-Agent/b2aaf634151b4706892693ffb43d9093.png" class="" title="LightRAG Diagram">
<h2 id="Prompt-Engineering">Prompt Engineering</h2>
<p>ref: <a target="_blank" rel="noopener" href="https://dannyzheng.me/2025/02/21/prompt-engineering/#the-prompt-engineering-lifecycle">https://dannyzheng.me/2025/02/21/prompt-engineering/#the-prompt-engineering-lifecycle</a></p>
<img src="/2025/04/21/AI-Agent/prompt_components.png" class="" title="img">
<h3 id="Base-2">Base</h3>
<h4 id="Zero-Shot-Prompting">Zero-Shot Prompting</h4>
<p>Zero-Shot Prompting æ˜¯æŒ‡åœ¨ä¸ç»™æ¨¡å‹ä»»ä½•ç¤ºä¾‹çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æå‡ºé—®é¢˜æˆ–ä»»åŠ¡ã€‚è¯¥æ–¹æ³•ä¾èµ–äºæ¨¡å‹çš„é¢„è®­ç»ƒçŸ¥è¯†ï¼Œé€‚ç”¨äºæ¨¡å‹å·²å¹¿æ³›å­¦ä¹ ç›¸å…³é¢†åŸŸä¿¡æ¯çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š</p>
<blockquote>
<p><strong>Prompt</strong>ï¼šå°†ä¸‹é¢è¿™å¥è¯ç¿»è¯‘æˆè‹±æ–‡ï¼šæˆ‘å–œæ¬¢å­¦ä¹ äººå·¥æ™ºèƒ½ã€‚<br>
<strong>Output</strong>ï¼šI like studying artificial intelligence.</p>
</blockquote>
<p>è¯¥æ–¹æ³•ç®€å•é«˜æ•ˆï¼Œé€‚ç”¨äºä»»åŠ¡æ˜ç¡®ã€æ¨¡å‹å·²å…·å¤‡ç›¸å…³èƒŒæ™¯çŸ¥è¯†çš„åœºæ™¯ã€‚</p>
<br>
<h4 id="Few-Shot-Prompting">Few-Shot Prompting</h4>
<p>Few-Shot Prompting æ˜¯åœ¨æç¤ºä¸­æä¾›å°‘é‡ï¼ˆé€šå¸¸æ˜¯1-5ä¸ªï¼‰ç¤ºä¾‹ï¼Œä»¥å¸®åŠ©æ¨¡å‹ç†è§£ä»»åŠ¡æ ¼å¼æˆ–é€»è¾‘ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹åœ¨ç»“æ„åŒ–ä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚ä¾‹å¦‚ï¼š</p>
<blockquote>
<p><strong>Prompt</strong>ï¼š<br>
ç¿»è¯‘ä¸‹åˆ—å¥å­ï¼š<br>
ä¾‹1ï¼šæˆ‘çˆ±ç¼–ç¨‹ã€‚ â†’ I love programming.<br>
ä¾‹2ï¼šå¤©æ°”å¾ˆå¥½ã€‚ â†’ The weather is nice.<br>
è¯·ç¿»è¯‘ï¼šæˆ‘åœ¨çœ‹ä¹¦ã€‚<br>
<strong>Output</strong>ï¼šI am reading a book.</p>
</blockquote>
<p>Few-Shot Prompting åˆ©ç”¨â€œç±»æ¯”â€æ–¹å¼ï¼Œå¸®åŠ©æ¨¡å‹å¯¹ä»»åŠ¡å½¢æˆæ›´æ˜ç¡®çš„ç†è§£ã€‚</p>
<br>
<h4 id="Chain-of-Thought-CoT-Prompting">Chain-of-Thought (CoT) Prompting</h4>
<p>ref: <a target="_blank" rel="noopener" href="https://dannyzheng.me/2025/02/21/prompt-engineering/#the-prompt-engineering-lifecycle">https://dannyzheng.me/2025/02/21/prompt-engineering/#the-prompt-engineering-lifecycle</a></p>
<blockquote>
<p>CoT tip: Always have LLM output its thinking. Without outputting its thought process, no thinking occurs!</p>
</blockquote>
<ul>
<li>
<p>Basic prompt: Include â€œThink step-by-stepâ€ in your prompt.</p>
<ul>
<li>
<p>Lacks guidance on how to think (which is especially not ideal if a task is very specific to your app, use case, or organization)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Draft personalized emails to donors asking for contributions to this yearâ€™s Care for Kids program.</span><br><span class="line"></span><br><span class="line">Program information:</span><br><span class="line">&lt;program&gt;&#123;&#123;PROGRAM_DETAILS&#125;&#125;</span><br><span class="line">&lt;/program&gt;</span><br><span class="line"></span><br><span class="line">Donor information:</span><br><span class="line">&lt;donor&gt;&#123;&#123;DONOR_DETAILS&#125;&#125;</span><br><span class="line">&lt;/donor&gt;</span><br><span class="line"></span><br><span class="line">Think step-by-step before you write the email.</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Guided prompt: Outline specific steps for LLM to follow in its thinking process.</p>
<ul>
<li>
<p>Lacks structuring to make it easy to strip out and separate the answer from the thinking.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Draft personalized emails to donors asking for contributions to this yearâ€™s Care for Kids program.</span><br><span class="line"></span><br><span class="line">Program information:</span><br><span class="line">&lt;program&gt;&#123;&#123;PROGRAM_DETAILS&#125;&#125;</span><br><span class="line">&lt;/program&gt;</span><br><span class="line"></span><br><span class="line">Donor information:</span><br><span class="line">&lt;donor&gt;&#123;&#123;DONOR_DETAILS&#125;&#125;</span><br><span class="line">&lt;/donor&gt;</span><br><span class="line"></span><br><span class="line">Think before you write the email. First, think through what messaging might appeal to this donor given their donation history and which campaigns theyâ€™ve supported in the past. Then, think through what aspects of the Care for Kids program would appeal to them, given their history. Finally, write the personalized donor email using your analysis.</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Structured prompt: Use XML tags like &lt;think&gt; &lt;/think&gt; and &lt;answer&gt; &lt;/answer&gt; to separate reasoning from the final answer.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Draft personalized emails to donors asking for contributions to this yearâ€™s Care for Kids program.</span><br><span class="line"></span><br><span class="line">Program information:</span><br><span class="line">&lt;program&gt;&#123;&#123;PROGRAM_DETAILS&#125;&#125;</span><br><span class="line">&lt;/program&gt;</span><br><span class="line"></span><br><span class="line">Donor information:</span><br><span class="line">&lt;donor&gt;&#123;&#123;DONOR_DETAILS&#125;&#125;</span><br><span class="line">&lt;/donor&gt;</span><br><span class="line"></span><br><span class="line">Think before you write the email in &lt;thinking&gt; tags. First, think through what messaging might appeal to this donor given their donation history and which campaigns theyâ€™ve supported in the past. Then, think through what aspects of the Care for Kids program would appeal to them, given their history. Finally, write the personalized donor email in &lt;email&gt; tags, using your analysis.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Use code (e.g. extract from <code>&lt;answer&gt;</code> tags) to extract the desired answer from the LLMâ€™s response</p>
</blockquote>
</li>
</ul>
<br>
<h4 id="Self-Consistency-Prompting">Self-Consistency Prompting</h4>
<p>Self-Consistency Prompting æ˜¯ Chain-of-Thought çš„ä¸€ç§å¢å¼ºç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨é¢å¯¹å¤æ‚æ¨ç†é—®é¢˜æ—¶ï¼Œé€šè¿‡ç”Ÿæˆå¤šä¸ªä¸åŒçš„æ¨ç†è·¯å¾„ï¼ˆå¤šæ¬¡ç”Ÿæˆï¼‰ï¼Œç„¶åå¯¹è¿™äº›è·¯å¾„çš„æœ€ç»ˆç»“æœè¿›è¡ŒæŠ•ç¥¨æˆ–æ±‡æ€»ï¼Œä»¥æé«˜ç­”æ¡ˆçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºä¸€é“æ•°å­¦é¢˜ï¼Œæ¨¡å‹å¯èƒ½åœ¨ä¸åŒå°è¯•ä¸­ç»™å‡ºä¸åŒçš„æ€è·¯æˆ–ç­”æ¡ˆï¼Œä½†é€šè¿‡â€œå¤šæ•°æŠ•ç¥¨â€å¯ä»¥è·å¾—æ›´ä¸€è‡´ã€å‡†ç¡®çš„ç»“æœã€‚</p>
<blockquote>
<p><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆ5æ¡ä¸åŒçš„æ¨ç†è·¯å¾„</li>
<li>æ±‡æ€»5ä¸ªæœ€ç»ˆç­”æ¡ˆ</li>
<li>é€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„ä¸€ä¸ªä½œä¸ºæœ€ç»ˆè¾“å‡º</li>
</ul>
</blockquote>
<p>è¿™ç§æ–¹æ³•ç‰¹åˆ«é€‚åˆå¯¹å•æ¬¡è¾“å‡ºä¸å¤Ÿç¨³å®šçš„ä»»åŠ¡ï¼Œæ¯”å¦‚å¤æ‚é€»è¾‘ã€æ•°å­¦é¢˜ç­‰åœºæ™¯ã€‚</p>
<br>
<h4 id="Retrieval-Augmented-Generation-RAG">Retrieval-Augmented Generation (RAG)</h4>
<p>RAG æ˜¯å°†å¤–éƒ¨çŸ¥è¯†æ£€ç´¢æœºåˆ¶ï¼ˆå¦‚æ–‡æ¡£ã€æ•°æ®åº“ã€æœç´¢å¼•æ“ï¼‰ä¸è¯­è¨€æ¨¡å‹ç”Ÿæˆèƒ½åŠ›ç»“åˆèµ·æ¥çš„ä¸€ç§æ–¹æ³•ã€‚æ¨¡å‹åœ¨å›ç­”é—®é¢˜å‰ï¼Œä¼šå…ˆâ€œæ£€ç´¢â€ç›¸å…³å†…å®¹ï¼Œå†åŸºäºæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆã€‚</p>
<p>è¿™ç§æ–¹æ³•å…‹æœäº†å¤§æ¨¡å‹â€œè®°å¿†æœ‰é™â€çš„é—®é¢˜ï¼Œå°¤å…¶åœ¨å¤„ç†éœ€è¦æ—¶æ•ˆæ€§æˆ–ç‰¹å®šèƒŒæ™¯çŸ¥è¯†çš„ä»»åŠ¡æ—¶éå¸¸æœ‰æ•ˆã€‚</p>
<blockquote>
<p><strong>ç¤ºä¾‹æµç¨‹</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·æé—®ï¼šâ€œè¯·è§£é‡Šä»€ä¹ˆæ˜¯é‡å­çº ç¼ ï¼Ÿâ€</li>
<li>æ¨¡å‹è°ƒç”¨æ£€ç´¢æ¨¡å—ï¼Œä»çŸ¥è¯†åº“æˆ–ç½‘ç»œä¸­æ‰¾åˆ°é«˜ç›¸å…³èµ„æ–™</li>
<li>åŸºäºèµ„æ–™ï¼Œç”Ÿæˆç¬¦åˆä¸Šä¸‹æ–‡ã€å‡†ç¡®å¯é çš„å›ç­”</li>
</ol>
</blockquote>
<p>RAG é€‚ç”¨äºé—®ç­”ç³»ç»Ÿã€çŸ¥è¯†å¯†é›†å‹å¯¹è¯ç³»ç»Ÿã€ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“åº”ç”¨ç­‰åœºæ™¯ã€‚</p>
<br>
<h3 id="Medprompt">Medprompt</h3>
<p>MedPrompt is composed of the following prompting techniques:</p>
<ul>
<li>Dynamic few-shot selection: instead of using static few-shot examples, Medprompt selects few-shot examples dynamically based on the question.</li>
<li>Self-generated chain of thought.</li>
<li>Choice shuffle ensembling: performs choice shuffle and self-consistency prompting.</li>
</ul>
<img src="/2025/04/21/AI-Agent/Medqa-comp.png" class="" title="img">
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="RAGæ€»ç»“">RAGæ€»ç»“</h3>
<p><a target="_blank" rel="noopener" href="https://holistic-authority-5c2.notion.site/RAG-1e3f66b636ba80f1b425dc15d7fae04c">https://holistic-authority-5c2.notion.site/RAG-1e3f66b636ba80f1b425dc15d7fae04c</a></p>
<h3 id="Cursorå®ç°æ¯ç§’-1000-tokens-çš„æ–‡ä»¶ç¼–è¾‘">Cursorå®ç°æ¯ç§’ 1000 tokens çš„æ–‡ä»¶ç¼–è¾‘</h3>
<p><a target="_blank" rel="noopener" href="https://web.archive.org/web/20240605010559/https://www.cursor.com/blog/instant-apply">https://web.archive.org/web/20240605010559/https://www.cursor.com/blog/instant-apply</a></p>
<p>ç¬¬ä¸€é˜¶æ®µ - è§„åˆ’ï¼ˆPlanningï¼‰ï¼šä½¿ç”¨ GPT æˆ– Claude ç­‰å¼ºå¤§æ¨¡å‹ é€šè¿‡èŠå¤©ç•Œé¢ç†è§£ç”¨æˆ·éœ€æ±‚ï¼Œåˆ¶å®šç¼–è¾‘è®¡åˆ’</p>
<p>ç¬¬äºŒé˜¶æ®µ - ä»£ç ç”Ÿæˆï¼ˆCode Generationï¼‰ï¼šåŒæ ·ä½¿ç”¨ Claude/GPT ç­‰å¤§æ¨¡å‹ æ ¹æ®è§„åˆ’ç”Ÿæˆå…·ä½“çš„ä»£ç å†…å®¹å’Œç¼–è¾‘æŒ‡ä»¤ è¾“å‡ºç±»ä¼¼&quot;åœ¨è¿™ä¸ªä½ç½®æ·»åŠ è¿™æ®µä»£ç &quot;çš„è¯¦ç»†å˜æ›´æè¿°</p>
<p>ç¬¬ä¸‰é˜¶æ®µ - å¿«é€Ÿåº”ç”¨ï¼ˆFast Applyï¼‰ï¼šä½¿ç”¨ Cursor è‡ªå·±è®­ç»ƒçš„ Llama-3-70b-ft æ¨¡å‹ ä¸“é—¨è´Ÿè´£å°†ç¬¬äºŒé˜¶æ®µç”Ÿæˆçš„ä»£ç å˜æ›´å¿«é€Ÿã€å‡†ç¡®åœ°åº”ç”¨åˆ°å®é™…æ–‡ä»¶ä¸­ é€šè¿‡ speculative edits æŠ€æœ¯å®ç° ~1000 tokens/ç§’çš„æ–‡ä»¶é‡å†™é€Ÿåº¦</p>
<p>å…³é”®ç‚¹ï¼šå‰ä¸¤ä¸ªé˜¶æ®µï¼šClaude/GPT è´Ÿè´£æ€è€ƒå’Œç”Ÿæˆä»£ç å†…å®¹ ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼šCursor è‡ªè®­ç»ƒæ¨¡å‹è´Ÿè´£é«˜é€Ÿæ‰§è¡Œæ–‡ä»¶æ“ä½œ</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç¬¬ä¸‰é˜¶æ®µçš„ä¸“é—¨æ¨¡å‹ï¼Ÿ 1. é€Ÿåº¦ç“¶é¢ˆï¼šClaude/GPT åœ¨æ–‡ä»¶ç¼–è¾‘æ—¶å¤ªæ…¢ï¼Œä¼šæ‰“æ–­ç¼–ç¨‹æµç¨‹ 2. æŠ€æœ¯é™åˆ¶ï¼šæ— æ³•åœ¨ç¬¬ä¸‰æ–¹ API ä¸­å®ç° speculative edits ä¼˜åŒ– 3. å‡†ç¡®æ€§é—®é¢˜ï¼šå¤§æ¨¡å‹åœ¨ diff æ ¼å¼ä¸Šå®¹æ˜“å‡ºé”™ï¼Œç»å¸¸æœ‰è¯­æ³•é”™è¯¯æˆ–&quot;æ‡’æƒ°&quot;è¡Œä¸º 4. æˆæœ¬æ§åˆ¶ï¼šé¿å…æ¯æ¬¡æ–‡ä»¶æ“ä½œéƒ½è°ƒç”¨æ˜‚è´µçš„å•†ä¸š API è¿™ç§è®¾è®¡è®©å¤§æ¨¡å‹ä¸“æ³¨äºå®ƒä»¬æ“…é•¿çš„æ¨ç†å’Œä»£ç ç”Ÿæˆï¼Œè€Œè®©ä¸“é—¨ä¼˜åŒ–çš„æ¨¡å‹å¤„ç†ç²¾ç¡®ã€é«˜é€Ÿçš„æ–‡ä»¶ç¼–è¾‘æ“ä½œã€‚</p>
<br>
<h3 id="å¹»è§‰å¤„ç†">å¹»è§‰å¤„ç†</h3>
<p><a target="_blank" rel="noopener" href="https://cvs-health.github.io/uqlm/latest/index.html">https://cvs-health.github.io/uqlm/latest/index.html</a></p>
<p>é»‘ç›’è¯„åˆ†å™¨</p>
<img src="/2025/04/21/AI-Agent/black_box_graphic.png" class="" title="_images&#x2F;black_box_graphic.png">
<p>ç™½ç›’è¯„åˆ†å™¨</p>
<img src="/2025/04/21/AI-Agent/white_box_graphic.png" class="" title="_images&#x2F;white_box_graphic.png">
<p>LLMè¯„åˆ†</p>
<img src="/2025/04/21/AI-Agent/judges_graphic.png" class="" title="_images&#x2F;judges_graphic.png">
<p>é›†æˆè¯„åˆ†å™¨</p>
<img src="/2025/04/21/AI-Agent/uqensemble_generate_score.png" class="" title="_images&#x2F;uqensemble_generate_score.png">
<br>
<p>GPTè®°å¿†</p>
<p>ref: <a target="_blank" rel="noopener" href="https://macro.com/app/md/54115a42-3409-4f5b-9120-f144d3ecd23a">https://macro.com/app/md/54115a42-3409-4f5b-9120-f144d3ecd23a</a></p>
<img src="/2025/04/21/AI-Agent/GsmyMNLasAQ_DY6" class="" title="img">
<img src="/2025/04/21/AI-Agent/GsmySEdaQAACdBZ" class="" title="img">
<br>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python-Pytorch/" rel="tag"># Python, Pytorch</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/04/16/Search-Ads-Rec-Rela/" rel="prev" title="SAR&Rela">
      <i class="fa fa-chevron-left"></i> SAR&Rela
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/04/22/Machine-Learning/" rel="next" title="Machine-Learning">
      Machine-Learning <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">AI-Agent</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LangChain"><span class="nav-text">LangChain</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-text">Model</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Key-methods"><span class="nav-text">Key methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Tool-calling"><span class="nav-text">Tool calling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Structured-Output"><span class="nav-text">Structured Output</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multimodality"><span class="nav-text">Multimodality</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Memory"><span class="nav-text">Memory</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9F%AD%E6%9C%9F%E8%AE%B0%E5%BF%86"><span class="nav-text">çŸ­æœŸè®°å¿†</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E6%B6%88%E6%81%AF%E5%88%97%E8%A1%A8"><span class="nav-text">ç¼–è¾‘æ¶ˆæ¯åˆ—è¡¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E8%BF%87%E5%BE%80%E5%AF%B9%E8%AF%9D"><span class="nav-text">æ€»ç»“è¿‡å¾€å¯¹è¯</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%95%BF%E6%9C%9F%E8%AE%B0%E5%BF%86"><span class="nav-text">é•¿æœŸè®°å¿†</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AE%B0%E5%BF%86%E5%AD%98%E5%82%A8"><span class="nav-text">è®°å¿†å­˜å‚¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%95%BF%E6%9C%9F%E8%AE%B0%E5%BF%86%E6%80%9D%E8%80%83%E6%A1%86%E6%9E%B6"><span class="nav-text">é•¿æœŸè®°å¿†æ€è€ƒæ¡†æ¶</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%B0%E5%BF%86%E7%B1%BB%E5%9E%8B"><span class="nav-text">è®°å¿†ç±»å‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%B0%E5%BF%86%E5%86%99%E5%85%A5"><span class="nav-text">è®°å¿†å†™å…¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Caching"><span class="nav-text">Caching</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prompt"><span class="nav-text">Prompt</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PromptTemplate"><span class="nav-text">PromptTemplate</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Semantic-search-engine"><span class="nav-text">Semantic search engine</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Chunking"><span class="nav-text">Chunking</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Better-Chunking"><span class="nav-text">Better Chunking</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Embedding-Vector-Store"><span class="nav-text">Embedding &amp; Vector Store</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrieval"><span class="nav-text">Retrieval</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Agent"><span class="nav-text">Agent</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Base"><span class="nav-text">Base</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#QA-Processing-Method"><span class="nav-text">QA Processing Method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Streaming-message-Streaming-tokens"><span class="nav-text">Streaming message &amp; Streaming tokens</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Memory-Adding"><span class="nav-text">Memory Adding</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example"><span class="nav-text">Example</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Extraction-Chain"><span class="nav-text">Extraction Chain</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Schema-Extrator"><span class="nav-text">Schema &amp; Extrator</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RAG-based-long-context-extraction"><span class="nav-text">RAG based long context extraction</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Classify"><span class="nav-text">Classify</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LangGraph"><span class="nav-text">LangGraph</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Graph"><span class="nav-text">Graph</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Agentic-Design-Patterns"><span class="nav-text">Agentic Design Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Design-Pattern"><span class="nav-text">Design Pattern</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reflection"><span class="nav-text">Reflection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tool-Use"><span class="nav-text">Tool Use</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Planning"><span class="nav-text">Planning</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Agent-Collaboration"><span class="nav-text">Multi-Agent Collaboration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MCP"><span class="nav-text">MCP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E8%B0%83%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9E%84%E5%BB%BA"><span class="nav-text">å¾®è°ƒæ•°æ®é›†æ„å»º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chunking-2"><span class="nav-text">Chunking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E5%88%9B%E5%BB%BA-%E9%97%AE%E9%A2%98%E6%B1%82%E8%A7%A3"><span class="nav-text">é—®é¢˜åˆ›å»º&amp;é—®é¢˜æ±‚è§£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KBQA"><span class="nav-text">KBQA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Semantic-Parsing-based-Methods"><span class="nav-text">Semantic Parsing-based Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Information-retrieval-based-Methods"><span class="nav-text">Information retrieval-based Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-Methods"><span class="nav-text">Other Methods</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAG"><span class="nav-text">RAG</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RAG-Design"><span class="nav-text">RAG Design</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Effective-Chunking-Strategies-for-RAG"><span class="nav-text">Effective Chunking Strategies for RAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Embedding"><span class="nav-text">Embedding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reranker"><span class="nav-text">Reranker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Extended-Method"><span class="nav-text">Extended Method</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%81%87%E8%AE%BE%E6%80%A7%E6%96%87%E6%A1%A3%E5%B5%8C%E5%85%A5-Hypothetical-Document-Embedding-HDE"><span class="nav-text">å‡è®¾æ€§æ–‡æ¡£åµŒå…¥ (Hypothetical Document Embedding - HDE)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%BC%8F%E6%A3%80%E7%B4%A2%E7%94%9F%E6%88%90-Iterative-Retrieval-Generation-IRG"><span class="nav-text">è¿­ä»£å¼æ£€ç´¢ç”Ÿæˆ (Iterative Retrieval Generation - IRG)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%A8%A0%E5%AF%86%E5%8A%A0%E7%A8%80%E7%96%8F%E6%A3%80%E7%B4%A2-Optimized-Dense-Sparse-Retrieval"><span class="nav-text">ä¼˜åŒ–ç¨ å¯†åŠ ç¨€ç–æ£€ç´¢ (Optimized Dense + Sparse Retrieval)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Improved-RAG"><span class="nav-text">Improved RAG</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GraphRAG"><span class="nav-text">GraphRAG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LightRAG"><span class="nav-text">LightRAG</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prompt-Engineering"><span class="nav-text">Prompt Engineering</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Base-2"><span class="nav-text">Base</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Zero-Shot-Prompting"><span class="nav-text">Zero-Shot Prompting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Few-Shot-Prompting"><span class="nav-text">Few-Shot Prompting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Chain-of-Thought-CoT-Prompting"><span class="nav-text">Chain-of-Thought (CoT) Prompting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Self-Consistency-Prompting"><span class="nav-text">Self-Consistency Prompting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrieval-Augmented-Generation-RAG"><span class="nav-text">Retrieval-Augmented Generation (RAG)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Medprompt"><span class="nav-text">Medprompt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-text">å…¶ä»–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RAG%E6%80%BB%E7%BB%93"><span class="nav-text">RAGæ€»ç»“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cursor%E5%AE%9E%E7%8E%B0%E6%AF%8F%E7%A7%92-1000-tokens-%E7%9A%84%E6%96%87%E4%BB%B6%E7%BC%96%E8%BE%91"><span class="nav-text">Cursorå®ç°æ¯ç§’ 1000 tokens çš„æ–‡ä»¶ç¼–è¾‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%BB%E8%A7%89%E5%A4%84%E7%90%86"><span class="nav-text">å¹»è§‰å¤„ç†</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="marigo1d"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">marigo1d</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/marigo1d" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;marigo1d" rel="noopener" target="_blank">GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">marigo1d</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">529k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">16:01</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
